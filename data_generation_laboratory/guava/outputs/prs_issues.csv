Issue_NumberPR_NumberIssue_TitleIssue_BodyIssue_CommentsPR_TitlePR_BodyPR_CommentsPR_Author_NamePR_Author_UsernamePR_Closed_Date
3090.03099Fix broken badge in Readmemaven-badges.herokuapp.com is frequently (and currently) broken."Thanks.

The _new_ badge just showed up as broken for me, but it worked after a refresh. Hopefully it will prove more reliable over time. =||= ü§¶‚Äç‚ôÇÔ∏è  haha yeah I noticed that too. Seems fine now‚Ä¶

I think it should be at least as reliable as before, since `maven-badges.herokuapp.com` also depends on `shields.io` =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add java.time.Duration overloads to CacheBuilder:
  cacheBuilder.expireAfterAccess(Duration)
  cacheBuilder.expireAfterWrite(Duration)
  cacheBuilder.refreshAfterWrite(Duration)

Fixes https://github.com/google/guava/issues/2999

RELNOTES=Add `java.time.Duration` overloads to `CacheBuilder`.

ffa5051884eacf180b5511ab270885960eb792d0

-------

<p> remove maven-badges.herokuapp.com from readme

Fixes #3090

de5a62a3d185b41875be8318e633698e85c045bf"Ron Shapiroronshapiro04/04/18, 01:27:25 PM
3107.03117Fix toString of NonSerializableMemoizingSupplierDelegate is set to null once the value has been computed, but is still referenced by the toString method. When it's null, use the value instead.First solution I thought of =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix toString of NonSerializableMemoizingSupplier

Fixes #3107

9185822ee16cdd641657c0f8e7ead755c9e9a564

-------

<p> Use Splitter instead of String.split, in InternetDomainName.

e56f1aa3d21b04eed8f5481d4103c05af5c51ec7

-------

<p> Use Splitter for IPv6, too. This eliminates usage of java.util.regex from this file (which is used via String.split, otherwise).

65a2a7de4ef4eea913f769a5cbbce6e35e1fccce

-------

<p> Use Diamond.

27eb336c2a2d9068878edbf49edcca493cd69cd8

-------

<p> Automated rollback of a12ef6b46b26fe178021c099e3db6a8a99f5174e.

It looks like the original change can cause an infinite loop in LocalCache.LoadingValueReference.get().

c2266a6ff8c6f298673688d6779b8b7368fe9147

-------

<p> Don't enable use of Unsafe.getLong() on aarch64 devices.

Android devices may report to run aarch64 while running in 32-bit mode, and then
crash when loading 64-bit values at unaligned addresses.

263bbcf6cf0cfae6768ddf9e9f3d749da555e422"Ron Shapiroronshapiro04/18/18, 07:56:52 PM
3145.03146Put type annotations on types, not declarations"To improve readability, the Java Language Specification recommends that type annotations are written ""immediately before the type to which they apply"" (https://docs.oracle.com/javase/specs/jls/se8/html/jls-9.html#jls-9.7.4).  This pull request makes Guava conform to that style guideline."Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Move type annotations immediately before the type they apply
to

Fixes #3145

RELNOTES=N/A

4270efbda891a947c1bfdb3e5707741a63b40551"Ron Shapiroronshapiro05/14/18, 11:30:16 PM
3154.03158Use api instead of compile for Android"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here (e.g. `I signed it!`) and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

<!-- need_sender_cla --> =||= The direct analogous is `api`. `implementation` is merely an optimization that should be opted into. =||= I signed it! =||= CLAs look good, thanks!

<!-- ok --> =||= @JakeWharton I thought it was the other way round? Isn't `implementation` the same as `compile`, with `api` being the optimisation? :/ =||= @JakeWharton Wait, I'm challenging myself now. I realise that I'm not 100% clear on the difference between `api` and `implementation`, so never mind. :) =||= No. Compile transitively exposes the dependency on the classpath of
downstream modules which is the same as api. Implementation hides the
dependency. Of course Gradle doesn't enforce or validate any of this so
it's a giant footgun unless you know what you're doing.

On Wed, May 23, 2018 at 5:06 PM Jonathan Bluett-Duncan <
notifications@github.com> wrote:

> @JakeWharton <https://github.com/JakeWharton> I thought it was the other
> way round? Isn't implementation the same as compile, with api being the
> optimisation? :/
>
> ‚Äî
> You are receiving this because you were mentioned.
>
>
> Reply to this email directly, view it on GitHub
> <https://github.com/google/guava/pull/3154#issuecomment-391496310>, or mute
> the thread
> <https://github.com/notifications/unsubscribe-auth/AAEEEQr2oPYUNU7S_Elfe1CRqzOecLqzks5t1c9OgaJpZM4ULLig>
> .
>
 =||= `api` it is then. =||= (Found https://docs.gradle.org/current/userguide/java_library_plugin.html#sec:java_library_separation to back up Jake.) =||= Hmm, so should we change the JRE one to `api`, as well? It sounds like `compile` may be deprecated. =||= I believe 'api' only exists for JRE projects if you're using the
'java-library' plugin. If you're using the regular 'java' plugin you only
get 'compile' and 'implementation' (the idea being you're a leaf node and
don't have anywhere to expose dependencies to).

On Wed, May 23, 2018 at 5:21 PM Chris Povirk <notifications@github.com>
wrote:

> Hmm, so should we change the JRE one to api, as well? It sounds like
> compile may be deprecated.
>
> ‚Äî
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/google/guava/pull/3154#issuecomment-391500545>, or mute
> the thread
> <https://github.com/notifications/unsubscribe-auth/AAEEEdtfVy2mpf-Lvk32inHC4veUluBBks5t1dLdgaJpZM4ULLig>
> .
>
 =||= @cpovirk `compile` is indeed deprecated. :) =||= Huh. So is the idea that Android projects are more likely to use the java-library plugin? If anything, I might have naively guessed they were _less_ likely :) Is it just that the default Android build setup suggests java-library or something? =||= Android projects use neither. API and implementation are available for all
Android plugins for about a year now. The reason these PRs are sweeping the
web is that they now wan when you use compile.

On Wed, May 23, 2018, 5:25 PM Chris Povirk <notifications@github.com> wrote:

> Huh. So is the idea that Android projects are more likely to use the
> java-library plugin? If anything, I might have naively guessed they were
> *less* likely :) Is it just that the default Android build setup suggests
> java-library or something?
>
> ‚Äî
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/google/guava/pull/3154#issuecomment-391501497>, or mute
> the thread
> <https://github.com/notifications/unsubscribe-auth/AAEEEcpsROIWL_DcsNPdWgCua0QkTdbQks5t1dO6gaJpZM4ULLig>
> .
>
 =||= Ah! Thanks. =||= Hmm. It sounds to me that `implementation` is the most sensible default, and `api` should be used only if the `java-library` plugin is imported _and_ the given project wants to expose Guava types to its users. Is my understanding correct @JakeWharton? =||= Your understanding is correct because you understand the implications.
Anyone who needs to look at the README to figure out how to add Guava
beyond maybe just copy/pasting the coordinates will not have that
understanding.

On Wed, May 23, 2018 at 5:35 PM Jonathan Bluett-Duncan <
notifications@github.com> wrote:

> Hmm. It sounds to me that implementation is the most sensible default,
> and api should be used only if the java-library plugin is imported *and*
> the given project wants to expose Guava types to its users. Is my
> understanding correct @JakeWharton <https://github.com/JakeWharton>?
>
> ‚Äî
> You are receiving this because you were mentioned.
> Reply to this email directly, view it on GitHub
> <https://github.com/google/guava/pull/3154#issuecomment-391504285>, or mute
> the thread
> <https://github.com/notifications/unsubscribe-auth/AAEEEQZJ1WltcLH-FZJ78-iTVPVWmCWeks5t1dYogaJpZM4ULLig>
> .
>
 =||= @JakeWharton Cool! So you're suggesting `api` here because it's the most liberal option and most equivalent to the older `compile`, am I right? =||= (Even for people who don't expose Guava in their APIs, I'd be a little nervous about excluding transitive dependencies from the classpath, given problems with static analyzers and perhaps annotation processors discussed in #2824 and #2721. (There could also be problems if people use Guava annotations but don't consider that ""exposing an API,"" but that seems less likely.) I suppose that those problems are relatively unlikely to affect people, though.) =||= Anyway, I do like the idea of suggesting the thing that is more likely to work (even if it's slower in some cases -- and I suspect only marginally so, since Guava isn't going to be changing between one build and the next). It is a little sad that this exports Guava to downstream targets, but that seems like the lesser evil (and no worse than what people see today).

One final thought: We _could_ decide to give instructions for each of...

- Java 8+
- Java 7
- Android

...where the Java 7 instructions look like the _current_ Android instructions and the Android instructions look like your new ones. But I'm not sure that's worth the potential confusion. =||= @cpovirk I think it's worth at least changing the remaining `compile` instruction for ""guava-jre"" to `api`, so that the Gradle installation instructions are consistent. :) =||= @jbduncan, @JakeWharton said above:

> I believe 'api' only exists for JRE projects if you're using the
> 'java-library' plugin. If you're using the regular 'java' plugin you only
> get 'compile' and 'implementation' (the idea being you're a leaf node and
> don't have anywhere to expose dependencies to).

So I worry that `api` won't exist for some people, and they'll be confused.

Does Gradle warn about `compile` in JRE projects like it does in Android projects? =||= @cpovirk Good point about @JakeWharton's comment!

Gradle does warn about `compile` in JRE projects too. :(

Taking all this into consideration, I think the best advice to give Gradle users is something like the following:

> To add a dependency using Gradle:
>
> ```gradle
> // For Java applications or Java libraries which use Guava internally:
> implementation 'com.google.guava:guava:25.1-jre'
> // Or, for Java libraries which use the ""java-library"" plugin and expose Guava types to users
> api 'com.google.guava:guava:25.1-jre'
> // Or, for Android applications & libraries which use Guava internally:
> implementation 'com.google.guava:guava:25.1-android'
> // Or, for Android libraries which use the ""java-library"" plugin and expose Guava types to users
> api 'com.google.guava:guava:25.1-android'
> ```

But having said this, the example advice I give above is quite verbose. I wonder if there's a better way of presenting it to Gradle&Guava users... =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Use api instead of compile for Android

Fixes #3154

03d7fd7e53382bc05795dc34632c4c81caf73b46"Ron Shapiroronshapiro05/25/18, 05:39:01 PM
3161.03170fix a grammar mistakefix a grammar mistake"We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.
In order to pass this check, please resolve this problem and have the pull request author add another comment and the bot will run again. If the bot doesn't comment, it means it doesn't think anything has changed.

<!-- need_author_cla --> =||= @AYWWWWW To make sure that your commit is signed with the email address you use for logging into GitHub, try following [these instructions](https://help.github.com/articles/setting-your-commit-email-address-in-git/) and then running `git commit --amend --reset-author` before force-pushing your ""fix a grammar mistake"" commit again. :) =||= CLAs look good, thanks!

<!-- ok --> =||= @jbduncan I googled and solved it . Thanks anyway =||= @AYWWWWW Cool, glad you managed to find your own way of solving it. :) =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> fix a grammar mistake

Fixes #3161

d60f7f352c7ce8ae031c916b045eb30a6f1a8ab8

-------

<p> In open-source Guava, completely skip trying to discover pluggable PatternCompiler implementations.

It's never been possible to create such implementations externally, anyway, and users are now seeing problems running the useless discovery code under the module system.

Fixes https://github.com/google/guava/issues/3147

RELNOTES=`base`: Fixed the `ServiceConfigurationError` that some users encountered when using Guava as a JPMS module.

0954b82dc4e3fe400550fcba78ae2878a8604c3b

-------

<p> Suppress exceptions raised from argument's toString methods during lenient formatting - take 2.

60c6e22c0ba9c7b305c787bd72e0fd4f1f005afc

-------

<p> Create an htmlescapers target for people who want to avoid the bulk of i18n identifiers and ICU4J.

e0eae79a5ba94850ca447116cd033447240d489e

-------

<p> Fix b/80241237 to correctly *not* change segment weight, nor report an eviction, when a compute() call does not change the present value.

RELNOTES=Fix a bug where Cache.asMap.compute* methods could cause nonsensical weights to be stored, breaking cache eviction.

21b52f64ceda0119daec68f6be2712bee55f02af"Ron Shapiroronshapiro05/31/18, 05:27:23 PM
3356.03393Remove unused imports and warnings"* Remove unused imports.
* Remove suppress warning annotations where not applicable and/or update suppression types"@liach Thanks, added similar changes to android as well =||= looks good (imo this has a big chance of merging as it's a bugfix) =||= Not sure what we're doing with `serial` warnings nowadays, but I'll import the rest of this. Thanks. =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add Report-To header.

https://www.w3.org/TR/reporting/

504978f1032ab9b6284ffadd1f94bdb7c870557a

-------

<p> Remove unused imports and warnings.

Fixes #3356

f0945a2ca741ead2a435cf52ddae2217763cc092

-------

<p> Reformat with google-java-format

RELNOTES=N/A

7809097021927058b21523e7b4d24d1f7fdb91b8

-------

<p> Add missing @Override annotations

8843b6ca39c8baddcf01991ea34ad91f87b30d82

-------

<p> Document the retention of listeners added to Guava implementations of ListenableFuture.

RELNOTES=Document the retention of listeners added to Guava implementations of `ListenableFuture`.

f6287e1b85eb4daf5678d252aaaf215a82f4fd2d

-------

<p> Reformat with google-java-format

RELNOTES=N/A

28cff42bc92b7685937c5771868167e0c03155d3

-------

<p> Name the method parameter 'unused' for ImmutableSortedSet.readObject(ObjectInputStream) (so the static analysis doesn't complain)

0967c796d6e6be72b0d9e8d68af66d6a7b524b54

-------

<p> Remove @Beta from APIs:

collect
- most Collectors (aside from BloomFilter and ImmutableRange*, as those whole classes are @Beta (though I did remove the redundant @Beta annotation from the Collector-returning methods for clarity))
- Maps: asConverter, immutableEnumMap
- MultimapBuilder
- Streams: stream(Iterable), concat

io
- ByteStreams: copy, toByteArray
- CharStreams: copy, toString
- Files: as(Char|Byte)(Source|Sink)

util.concurrent
- Futures: addCallback, getDone, getUnchecked, immediateCancelledFuture, immediateFailedFuture, immediateFuture
- ListeningScheduledExecutorService
- Uninterruptibles

other
- HtmlEscapers
- Splitter.splitToList
- Ticker

Fixes https://github.com/google/guava/pull/3287
Fixes https://github.com/google/guava/issues/3251 (aside from ImmutableRange*, but those whole classes are @Beta, anyway)
Addresses the main concerns of https://github.com/google/guava/issues/3285 but doesn't cover the broader request
Fixes https://github.com/google/guava/issues/3340
Partially addresses https://github.com/google/guava/issues/3239

RELNOTES=Removed `@Beta` from a number of frequently used APIs.

068cb9005cc701ed98e31df9b56117b86df21d0f

-------

<p> Add some known UTF-8 hash values to Murmur3_32 tests. UTF-8 is more comparable between platforms than relying on Java's internal encoding.

e7ec53773bcf89533496de1611ac4dddd876fb54

-------

<p> Remove @CanIgnoreReturnValue from Ordering.sortedCopy() and immutableSortedCopy().

RELNOTES=Remove `@CanIgnoreReturnValue` from `Ordering.sortedCopy()` and `immutableSortedCopy()`.

da2895f5c3a55b84771488e0f8a38c67e0f63543

-------

<p> Make a constructor private.

(I'm looking into EnumMap stuff for other reasons, and I got to wondering if this was used outside the file. Nope.)

b1933ce7d8c8ff0fac90b494b33ab8af159e1906

-------

<p> Delete WellBehavedMap.

The bug it worked around was fixed in Java 7:
https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6312706

And I don't believe it was ever present under Android:
https://android.googlesource.com/platform/libcore/+/fdb2704414a9ed92394ada0d1395e4db86889465/luni/src/main/java/java/util/EnumMap.java#146

I haven't looked for the absolute first version ever of GWT, but the still very old GWT file doesn't have the bug, either.

Deleting this class will simplify some work I'm doing around our EnumMap usage for j2cl.

2115c74c21ab47c3a41c2fb73a16aa6d051bf784

-------

<p> Internal GWT change

1d49ade94c3e7d2c056893a630739c8a6b897f66

-------

<p> Automated rollback of commit 1d49ade94c3e7d2c056893a630739c8a6b897f66

*** Original change description ***

Internal GWT change

***

46a2123f4b077840b4b466fe6344579ac4b52bad

-------

<p> Use J2ObjC's @RetainedWith annotation instead of @Weak on ImmutableMap.keySet
to prevent crashes on iOS.

TESTED=Created a map inside a autorelease pool and saved a reference to the
keyset. Checked that the keyset functions correctly outside the autorelease
pool. Checked that both the keyset and the map are deallocated by the
autorelease pool when not holding a reference to the keyset. Did this test with
both ImmutableMap.of(<2 entries>) and ImmutableBiMap.of(<2 entries>).

RELNOTES=J2ObjC: Fixes crashes from use of `ImmutableMap.keySet()`.

76c954518752acb36256009840ed004eef412291

-------

<p> Annotate checkNotNull's input and output as @NonNull.

We don't want to go down the road of annotating most things @NonNull, as we eventually want to use tools that assume that that's the default. However, it's pretty weird for checkNotNull() to return a @Nullable value in the minds of some tools, so let's annotate just that method and see how it goes.

RELNOTES=Annotated `checkNotNull`'s input and output as `@NonNull`.

63d0b31e62b4d4da33ec61a1d84d026391ffd126

-------

<p> Document the JDK 9+ alternative to `Maps#immutableEntry`

Fixes #3385

998858f9abd06b3774bf72a3b4f2fdaa18a88ceb

-------

<p> Modernize book reference.

7eafede7552490351956e8038bb07596b227e3ef

-------

<p> Create constants for the SourceMap header

None of the tests like this header name, so each required some workarounds.

RELNOTES=Add the SourceMap header to HttpHeaders

81f191e80265001b3dc8b4544cd0bb277a05ba7b

-------

<p> Internal GWT change

db6ada7b4f9db07b8de6ec549ca7e2ab6079b354

-------

<p> Use J2ObjC's @RetainedWith annotation instead of @Weak on ImmutableMap.values
to prevent crashes on iOS.

TESTED=Created a map inside an autorelease pool and saved a reference to the
values collection. Checked that the values collection functions correctly
outside the autorelease pool. Checked that both the values collection and the
map are deallocated by the autorelease pool when not holding a strong reference
to the values collection. Did this test with ImmutableMap.of(<2 entries>) and
ImmutableMap.copyOf(<EnumMap with 2 entries>).

RELNOTES=J2ObjC: Fixes crashes from use of `ImmutableMap.values()`.

05ac56322f6c3a4b0109aab2b46671716f109cb5

-------

<p> Fix Javadoc breakage under JDK11 canary.

https://bugs.openjdk.java.net/browse/JDK-8212233
https://bugs.openjdk.java.net/browse/JDK-8193030

d8bdef58d54712286d86a9146778d25614fd3c9a

-------

<p> Remove GWT emulations that are no longer needed as of GWT 2.8.2.

RELNOTES=Removed GWT emulations that are no longer needed as of GWT 2.8.2. This means that GWT projects that use this version of Guava must use GWT 2.8.2 or higher.

be02df5ad4a530d5cb206a7042de8c2f5dbbff32"Ron Shapiroronshapiro02/26/19, 07:18:55 PM
3385.03393Document the JDK 9+ alternative to `Maps#immutableEntry`"I think this suggestion is worthwhile for two reasons:
- The JDK 9+ alternative is null-hostile, fully in line with Guava's philosophy. (In fact, my colleagues and I were surprised to learn that `Maps.immutableEntry` allows nulls.)
- The excellent arguments in favour of `Immutable*` types put forth in #2969 do not hold here, since `Maps.immutableEntry` does not have a special return type that communicates its immutability."(we're merging this one in a sec, thank you for it!) =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add Report-To header.

https://www.w3.org/TR/reporting/

504978f1032ab9b6284ffadd1f94bdb7c870557a

-------

<p> Remove unused imports and warnings.

Fixes #3356

f0945a2ca741ead2a435cf52ddae2217763cc092

-------

<p> Reformat with google-java-format

RELNOTES=N/A

7809097021927058b21523e7b4d24d1f7fdb91b8

-------

<p> Add missing @Override annotations

8843b6ca39c8baddcf01991ea34ad91f87b30d82

-------

<p> Document the retention of listeners added to Guava implementations of ListenableFuture.

RELNOTES=Document the retention of listeners added to Guava implementations of `ListenableFuture`.

f6287e1b85eb4daf5678d252aaaf215a82f4fd2d

-------

<p> Reformat with google-java-format

RELNOTES=N/A

28cff42bc92b7685937c5771868167e0c03155d3

-------

<p> Name the method parameter 'unused' for ImmutableSortedSet.readObject(ObjectInputStream) (so the static analysis doesn't complain)

0967c796d6e6be72b0d9e8d68af66d6a7b524b54

-------

<p> Remove @Beta from APIs:

collect
- most Collectors (aside from BloomFilter and ImmutableRange*, as those whole classes are @Beta (though I did remove the redundant @Beta annotation from the Collector-returning methods for clarity))
- Maps: asConverter, immutableEnumMap
- MultimapBuilder
- Streams: stream(Iterable), concat

io
- ByteStreams: copy, toByteArray
- CharStreams: copy, toString
- Files: as(Char|Byte)(Source|Sink)

util.concurrent
- Futures: addCallback, getDone, getUnchecked, immediateCancelledFuture, immediateFailedFuture, immediateFuture
- ListeningScheduledExecutorService
- Uninterruptibles

other
- HtmlEscapers
- Splitter.splitToList
- Ticker

Fixes https://github.com/google/guava/pull/3287
Fixes https://github.com/google/guava/issues/3251 (aside from ImmutableRange*, but those whole classes are @Beta, anyway)
Addresses the main concerns of https://github.com/google/guava/issues/3285 but doesn't cover the broader request
Fixes https://github.com/google/guava/issues/3340
Partially addresses https://github.com/google/guava/issues/3239

RELNOTES=Removed `@Beta` from a number of frequently used APIs.

068cb9005cc701ed98e31df9b56117b86df21d0f

-------

<p> Add some known UTF-8 hash values to Murmur3_32 tests. UTF-8 is more comparable between platforms than relying on Java's internal encoding.

e7ec53773bcf89533496de1611ac4dddd876fb54

-------

<p> Remove @CanIgnoreReturnValue from Ordering.sortedCopy() and immutableSortedCopy().

RELNOTES=Remove `@CanIgnoreReturnValue` from `Ordering.sortedCopy()` and `immutableSortedCopy()`.

da2895f5c3a55b84771488e0f8a38c67e0f63543

-------

<p> Make a constructor private.

(I'm looking into EnumMap stuff for other reasons, and I got to wondering if this was used outside the file. Nope.)

b1933ce7d8c8ff0fac90b494b33ab8af159e1906

-------

<p> Delete WellBehavedMap.

The bug it worked around was fixed in Java 7:
https://bugs.java.com/bugdatabase/view_bug.do?bug_id=6312706

And I don't believe it was ever present under Android:
https://android.googlesource.com/platform/libcore/+/fdb2704414a9ed92394ada0d1395e4db86889465/luni/src/main/java/java/util/EnumMap.java#146

I haven't looked for the absolute first version ever of GWT, but the still very old GWT file doesn't have the bug, either.

Deleting this class will simplify some work I'm doing around our EnumMap usage for j2cl.

2115c74c21ab47c3a41c2fb73a16aa6d051bf784

-------

<p> Internal GWT change

1d49ade94c3e7d2c056893a630739c8a6b897f66

-------

<p> Automated rollback of commit 1d49ade94c3e7d2c056893a630739c8a6b897f66

*** Original change description ***

Internal GWT change

***

46a2123f4b077840b4b466fe6344579ac4b52bad

-------

<p> Use J2ObjC's @RetainedWith annotation instead of @Weak on ImmutableMap.keySet
to prevent crashes on iOS.

TESTED=Created a map inside a autorelease pool and saved a reference to the
keyset. Checked that the keyset functions correctly outside the autorelease
pool. Checked that both the keyset and the map are deallocated by the
autorelease pool when not holding a reference to the keyset. Did this test with
both ImmutableMap.of(<2 entries>) and ImmutableBiMap.of(<2 entries>).

RELNOTES=J2ObjC: Fixes crashes from use of `ImmutableMap.keySet()`.

76c954518752acb36256009840ed004eef412291

-------

<p> Annotate checkNotNull's input and output as @NonNull.

We don't want to go down the road of annotating most things @NonNull, as we eventually want to use tools that assume that that's the default. However, it's pretty weird for checkNotNull() to return a @Nullable value in the minds of some tools, so let's annotate just that method and see how it goes.

RELNOTES=Annotated `checkNotNull`'s input and output as `@NonNull`.

63d0b31e62b4d4da33ec61a1d84d026391ffd126

-------

<p> Document the JDK 9+ alternative to `Maps#immutableEntry`

Fixes #3385

998858f9abd06b3774bf72a3b4f2fdaa18a88ceb

-------

<p> Modernize book reference.

7eafede7552490351956e8038bb07596b227e3ef

-------

<p> Create constants for the SourceMap header

None of the tests like this header name, so each required some workarounds.

RELNOTES=Add the SourceMap header to HttpHeaders

81f191e80265001b3dc8b4544cd0bb277a05ba7b

-------

<p> Internal GWT change

db6ada7b4f9db07b8de6ec549ca7e2ab6079b354

-------

<p> Use J2ObjC's @RetainedWith annotation instead of @Weak on ImmutableMap.values
to prevent crashes on iOS.

TESTED=Created a map inside an autorelease pool and saved a reference to the
values collection. Checked that the values collection functions correctly
outside the autorelease pool. Checked that both the values collection and the
map are deallocated by the autorelease pool when not holding a strong reference
to the values collection. Did this test with ImmutableMap.of(<2 entries>) and
ImmutableMap.copyOf(<EnumMap with 2 entries>).

RELNOTES=J2ObjC: Fixes crashes from use of `ImmutableMap.values()`.

05ac56322f6c3a4b0109aab2b46671716f109cb5

-------

<p> Fix Javadoc breakage under JDK11 canary.

https://bugs.openjdk.java.net/browse/JDK-8212233
https://bugs.openjdk.java.net/browse/JDK-8193030

d8bdef58d54712286d86a9146778d25614fd3c9a

-------

<p> Remove GWT emulations that are no longer needed as of GWT 2.8.2.

RELNOTES=Removed GWT emulations that are no longer needed as of GWT 2.8.2. This means that GWT projects that use this version of Guava must use GWT 2.8.2 or higher.

be02df5ad4a530d5cb206a7042de8c2f5dbbff32"Ron Shapiroronshapiro02/26/19, 07:18:55 PM
3439.03441Upgrade error_proneto sync with the version protobuf is now usingThanks. Would going all the way to 2.3.3 be worse for your dependency-agreement efforts? =||= For weird and possibly arbitrary reasons, it's not quite as problematic if Guava jumps ahead of the pack; but it's still better if everyone can agree. I picked 2.3.2 only because protobuf already shipped with that version. I am thinking about how we might get some approximation of ONE_VERSION_ONLY on Github, but it's tricky.  =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Update GraphBuilder documentation with option of building an immutable graph

9b01341e204457911174d5b3fbb0222b543ba0e6

-------

<p> Simplify graph.PackageSanityTests by applying the new immutable graph builder.

c6c6c7323a16371dbbc65f5e31862bab3e38206c

-------

<p> Upgrade error_prone

Fixes #3439

0e928fc2b8ed23d2cca05c6cee40d95e495bc87c"Ron Shapiroronshapiro04/12/19, 04:18:51 PM
3398.03455Fixed some linksUpdated invalid links where I could find an alternative, removed othersMoe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fixed some links.

The comparisons to the Android Hash* classes haven't been accurate since at least CL 81367572, so I've removed them entirely.

Fixes #3398

1dc514b56a0fa213baa242acf9e58163638abef8

-------

<p> Migrate from assertThat(foo).named(""foo"") to assertWithMessage(""foo"").that(foo).

(The exact change is slightly different in some cases, like when using custom subjects or check(), but it's always a migration from named(...) to [assert]WithMessage(...).)

named(...) is being removed.

This CL may slightly modify the failure messages produced, but all the old information will still be present.

e70a2f9e53583c1c508a0f7b16bdcad8c3f2f740

-------

<p> Migrate from is(Not)SameAs to is(Not)SameInstanceAs.

They behave identically, and the old names are being removed.

Open-source note: The new methods are available in Truth as of version 0.44.

c19256717b493127a355fabf1eeb827fd0c64973

-------

<p> A few more doc tweaks, caught by @jbduncan in f2591b5c2a

414084c20aeb4b74fb85eab5cf0a787d76234939

-------

<p> Remove CheckedFuture from Guava.

RELNOTES=Removed deprecated `CheckedFuture` and related utilities.

cae1b9190e4bad3b6c01afbb08d9b0a366813c99

-------

<p> Migrate from assertThat(foo).named(""foo"") to assertWithMessage(""foo"").that(foo).

(The exact change is slightly different in some cases, like when using custom subjects or check(), but it's always a migration from named(...) to [assert]WithMessage(...).)

named(...) is being removed.

This CL may slightly modify the failure messages produced, but all the old information will still be present.

1f5c4780e522c32f9412e29cd2880124c81275e7"Ron Shapiroronshapiro05/05/19, 06:02:36 PM
3448.03463Add java.util.UUID to ArbitraryInstancesI hope this counts as a trivial change. This adds `java.util.UUID` to `ArbitratyInstances` - I have recently been working on a project where we used `UUID` and `NullPointerTester` and we've often had to set a default manually, this should avoid that.The build failure seems to be a problem with the build/travis rather than this change (it happens with other PRs too), but happy to make changes if that's not the case. =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add app.link to the Public Suffix List.

This is a temporary solution to stop app.link affiliated websites being grouped together in the Password Manager UI. We will reach out to the owners of app.link and work with them to update the public version of the PSL.

8268487ae35ede205c770797baa4b11b171e6025

-------

<p> Add java.util.UUID to ArbitraryInstances

Fixes #3448

ad3d9adf8c846f4853be966dda779f05d4e4060c

-------

<p> Upgrade compiler plugin.

Fixes https://github.com/google/guava/pull/3454.

7092295b535033b4b00786f9bc4c0708cf3e5165

-------

<p> Update versions of some Guava dependencies.

Fixes https://github.com/google/guava/issues/3405

ed830d31f824eb34df6898bbeb4de5b649300164"Ron Shapiroronshapiro05/08/19, 02:35:09 PM
3485.03495Clarify behavior of `ImmutableList#copyOf` for null argument."Afaik this is the behavior of all ImmutableCollection types. The class javadoc on ImmutableList explicitly refers to the ImmutableCollection which mentions this at the top. So these changes don‚Äòt seem necessary. =||= The factories are tested by other automated null tests, so let's not add more tests.

The existing doc is trying to say that the methods reject null elements, but it's saying it poorly, so thanks for raising this. How about this...?

```
@throws NullPointerException if {@code elements} contains a null element
```

That skips mentioning that `elements` itself might be `null`, but we always skip that, preferring to annotate the parameters that _can_ be `null` with `@Nullable`. (Otherwise, nearly all of our methods would have `@throws NullPointerException if x, y, or z is null`.) =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Remove `@Beta` from `setFuture`.

RELNOTES=Removed `@Beta` from `setFuture`.

2c717c0092ad5abbbe6a34d426e084623c651354

-------

<p> Upgrade maven-gpg-plugin to 1.6

Fixes github.com/google/guava/pull/3490

c10a1647ffa968a96273d0961a6f9e0181a4fe70

-------

<p> Clarify behavior of `ImmutableList#copyOf` for null argument.

Fixes #3485

6f655fb940809499719ba7679a425961e39a8feb

-------

<p> Make the incidentEdges() documentation a little bit more clear.

b0a05097900ab2decf17681d3dcd9154f225d91f

-------

<p> Simplify implementation of Graphs.reachableNodes()

b917492c31401a2e6092c8f3f6bc60040c1dcebe

-------

<p> Make the adjacentNodes() documentation a little bit more clear.

7a5a43b66a4f0a22077918404fa95a165ede2811

-------

<p> Delete deprecated callWithTimeout().

fa13235f2c8edff9cd6c434f8a164250decf0249"Ron Shapiroronshapiro06/06/19, 03:06:20 PM
3500.03519Fix typo in 'stoppingCount' variable nameMoe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add missing description tags to guava-parent poms.

We were previously apparently inheriting them from sonatype-oss-parent, until we removed that. Releases don't work without a description. ""Invalid POM: /com/google/guava/guava-parent/28.0-android/guava-parent-28.0-android.pom: Project description missing""

c417618b2be5c127baf8a739789615b3f5c5fe7c

-------

<p> Fix typo in 'stoppingCount' variable name

Fixes #3500

c168ba2f5939102ee0b3e3cbd941f213d3ff8e8a

-------

<p> Split catch() blocks so that javac doesn't generate a reference to their common supertype, ReflectiveOperationException.

ReflectiveOperationException isn't available on the old versions of Android that we support.

As far as we know, there is no actual problem with these references because no methods are called on them. However, the new version of Animal Sniffer we're updating to will flag them anyway, and I think that avoiding them is the safe thing to do.

Prepares for #3497

15c9a9385713910a1ecf9e5a5e6e50e13755fef3

-------

<p> Upgrade animal sniffer version to 1.18

Fixes #3497

afdecf706fa86c5d4760b8211df2b00806e9458c

-------

<p> Document default values of builder setters.

d5dca3613d5a47b87ed88a332e35e2f60a025630

-------

<p> Use saturatedToNanos() in CacheBuilder to avoid overflows.

RELNOTES=Use saturatedToNanos() in CacheBuilder to avoid overflows.

7d04f72bf355e9bac1312debb3af7dca28833077

-------

<p> Tweaks to the list of Guava features.

4dbc7c1a545bdf5dd20a5934ff66c171806957db

-------

<p> Add more @Nullables to variadic parameter lists.

RELNOTES=Add more @Nullables to variadic parameter lists.

fbae3f47239fbea0555b4df2c4aea474f23d4b70

-------

<p> Halve memory consumption when creating a Bloom filter.

AtomicLongArray(long[]) clones its input, which is a waste when we're passing
in a new array.

RELNOTES=Halve VmPeak when creating a Bloom filter.

f4998201486012d050092ebbdbfb10713e9df549

-------

<p> Use LongMath.saturatedAdd/Subtract in CacheStats.

Fixes https://github.com/google/guava/issues/3503

RELNOTES=avoid overflows/underflows in CacheStats

9f3d0481768aa3b0e08de20ab881df4579d6ad18

-------

<p> Fix the travis build

ba4111cb700754c4f6e9be3a5a35ab420610e2eb"Ron Shapiroronshapiro06/30/19, 02:58:50 PM
3497.03519Upgrade animal sniffer version to 1.18Version [1.18](https://github.com/mojohaus/animal-sniffer/milestone/5?closed=1) resolves a JDK8 compatibility issue, resource leak and ends support for JDK 7"Oops, forgot about the android JDK 7 compilation. Should I remove the upgrade for Android or close PR? =||= The JDK 7 failure appears to be a case in which Animal Sniffer is catching a real problem (implicit use of `ReflectiveOperationException`) that it was missing before. That's interesting because I've seen Animal Sniffer catch this problem in the past -- though maybe it was in a different project that was using a newer version?

I'll take care of the fix. =||= Oh, wait: I think what we saw was that Animal Sniffer caught the problem _if a method was called on the `ReflectiveOperationException`, which is the only scenario in which we'd seen it cause problems in practice. But we reasoned that other references to `ReflectiveOperationException` could cause problems (maybe for debugging or something) that we just hadn't seen yet, so it's nice that Animal Sniffer detects them now. =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add missing description tags to guava-parent poms.

We were previously apparently inheriting them from sonatype-oss-parent, until we removed that. Releases don't work without a description. ""Invalid POM: /com/google/guava/guava-parent/28.0-android/guava-parent-28.0-android.pom: Project description missing""

c417618b2be5c127baf8a739789615b3f5c5fe7c

-------

<p> Fix typo in 'stoppingCount' variable name

Fixes #3500

c168ba2f5939102ee0b3e3cbd941f213d3ff8e8a

-------

<p> Split catch() blocks so that javac doesn't generate a reference to their common supertype, ReflectiveOperationException.

ReflectiveOperationException isn't available on the old versions of Android that we support.

As far as we know, there is no actual problem with these references because no methods are called on them. However, the new version of Animal Sniffer we're updating to will flag them anyway, and I think that avoiding them is the safe thing to do.

Prepares for #3497

15c9a9385713910a1ecf9e5a5e6e50e13755fef3

-------

<p> Upgrade animal sniffer version to 1.18

Fixes #3497

afdecf706fa86c5d4760b8211df2b00806e9458c

-------

<p> Document default values of builder setters.

d5dca3613d5a47b87ed88a332e35e2f60a025630

-------

<p> Use saturatedToNanos() in CacheBuilder to avoid overflows.

RELNOTES=Use saturatedToNanos() in CacheBuilder to avoid overflows.

7d04f72bf355e9bac1312debb3af7dca28833077

-------

<p> Tweaks to the list of Guava features.

4dbc7c1a545bdf5dd20a5934ff66c171806957db

-------

<p> Add more @Nullables to variadic parameter lists.

RELNOTES=Add more @Nullables to variadic parameter lists.

fbae3f47239fbea0555b4df2c4aea474f23d4b70

-------

<p> Halve memory consumption when creating a Bloom filter.

AtomicLongArray(long[]) clones its input, which is a waste when we're passing
in a new array.

RELNOTES=Halve VmPeak when creating a Bloom filter.

f4998201486012d050092ebbdbfb10713e9df549

-------

<p> Use LongMath.saturatedAdd/Subtract in CacheStats.

Fixes https://github.com/google/guava/issues/3503

RELNOTES=avoid overflows/underflows in CacheStats

9f3d0481768aa3b0e08de20ab881df4579d6ad18

-------

<p> Fix the travis build

ba4111cb700754c4f6e9be3a5a35ab420610e2eb"Ron Shapiroronshapiro06/30/19, 02:58:50 PM
1973.03560Javadoc of HashBiMap#containsValue #inverse"The inherited doc should be overridden and mentioned that containsValue works in O(1) time in contrast to O(N) with a normal HashMap.

The javadoc for #inverse should mention that it always returns the same Inverse instance and thus saving the Inverse as a separate instance variable is not mandatory to reduce overhead.""I'll put this on my list, thanks.

On Fri, Feb 13, 2015 at 5:05 AM, Louis-Cyphre notifications@github.com
wrote:

> The inherited doc should be overridden and mentioned that containsValue
> works in O(1) time in contrast to O(N) with a normal HashMap.
> 
> The javadoc for #inverse should mention that it always returns the same
> Inverse instance and thus saving the Inverse as a separate instance
> variable is not mandatory to reduce overhead.
> 
> ‚Äî
> Reply to this email directly or view it on GitHub
> https://github.com/google/guava/issues/1973.

## 

Kevin Bourrillion | Java Librarian | Google, Inc. | kevinb@google.com
 =||= Is this issue approved? =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix an issue where the InputStream returned by BaseEncoding.decodingStream(Reader) could fail to throw DecodingException while decoding an invalid string.

This was caused by the default behavior of InputStream.read(byte[], int, int), which swallows any IOException thrown by any call to the single-byte read() method other than the first. To fix it, just override that method with an implementation that does not swallow any exceptions.

Fixes https://github.com/google/guava/issues/3542

4e6478d4bec284f047a686b8a16dc2b32628639a

-------

<p> Add more clarification on what ""access"" means in expireAfterAccess().
Previous comment doesn't mention ""containsKey()""

Copied from https://github.com/google/guava/wiki/CachesExplained#asmap

RELNOTES=comment change

f2bd7744e575393f065253c8f1bc2a512d452b63

-------

<p> Document that HashBiMap.containsValue() tends to run in faster-than-linear time (overriding the default documentation from AbstractMap.containsValue()).

Fixes #1973

7d57c233c9922ca9adbbef552b5f8f66bd7856f0

-------

<p> Add note about {@code ByteSource.wrap}'s use of the given byte array.

Fixes https://github.com/google/guava/issues/2603

9276a79f6e9b012935b791a3e6d0b7f3d00b715b

-------

<p> Fix https://github.com/google/guava/issues/3156 by implementing a proper `CollectSpliterators.flatMapTo{Int,Long,Double}`.

Also, modify the existing `CollectSpliterators.flatMap` to accept `null` from its `function` by treating it as an empty `Stream`, like `Stream.flatMap` does. Add tests for this behavior.

To test that the new methods also accept `null` through both their `{Int,Long,Double}Consumer` APIs and their `Consumer` APIs, add `of{Int,Long,Double}` methods to `SpliteratorTester`. They test the given `Spliterator.of{Int,Long,Double}` through both APIs.

0763099e769963bd0d93f865a4e7c3a5b320085a

-------

<p> Temporarily update public_suffix to include web.app

Without this, developers are not able to set up Google OAuth clients with URLs in Firebase Hosting web.app domain.

41b8aeaeb71cab1a151d4359a409bfd54bb81262"David P. Bakernetdpb08/16/19, 05:24:22 PM
3577.03579simply code RP"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!`) and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3577) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3577) for more info**.

<!-- ok --> =||= Thanks. We mostly avoid lambdas because we have a Java 7 backport, and we want to minimize diffs between the mainline and the backport. I'll get the `while` change merged. =||= @cpovirk Ok, I have received your messag =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix ""bug"" link that was actually a CL.

4c5e8a226a1c4a963d6041f7ee6aa32076fa2ac8

-------

<p> Simplify while+break into do-while.

Fixes #3577

39aadb3531f7d73ed634780abe2679c9e42bcb17

-------

<p> Release resources of whenAllSucceed/whenAllComplete once input futures are complete.

RELNOTES=Fixes potential memory leak in Futures.whenAllSucceed/whenAllComplete

a840d5bec35b56a6a6e195477e35a1b0e92d3681

-------

<p> Prepare for removing GWT-RPC support for Guava types by adding a system property that disables it.

When the time comes, we'll flip the default value, and users who didn't see our earlier warnings can use a system property to restore support until they can stop serializing our types.

[]

967010aa4d5ecf35fd3861913c3f17c10c4f6d40"Chris Povirkcpovirk08/26/19, 06:36:54 PM
1661.03618Would like implementation comments explaining CharMatcher.WHITESPACE_MULTIPLIER"_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1661) created by **magiciankid** on 2014-02-09 at 07:37 AM_

---

there is a magic number in the CharaMatcher : WHITESPACE_MULTIPLIER = 1682554634

wanntted a testcase or formula get this value , at least need a javadoc to comment it  ""_[Original comment](https://code.google.com/p/guava-libraries/issues/detail?id=1661#c2) posted by **magiciankid** on 2014-02-10 at 06:59 AM_

---

etc:
IntMath.gcd  documented http://en.wikipedia.org/wiki/Binary_GCD_algorithm
javadoc of Collections2.permutations notes it describe in TAOCP

these methods were well documented
 =||= _[Original comment](https://code.google.com/p/guava-libraries/issues/detail?id=1661#c3) posted by **kevinb@google.com** on 2014-02-10 at 04:58 PM_

---

Hm; I thought our Type- categories were complete enough, but we've never had a feature request for an implementation comment before.

As an internal implementation detail I'd expect this to be very low priority. Is there any particular reason you need this information?

---

**Status:** `Research`
**Labels:** -`Type-Addition`, `Type-Other`
 =||= _[Original comment](https://code.google.com/p/guava-libraries/issues/detail?id=1661#c5) posted by **magiciankid** on 2014-02-11 at 01:02 AM_

---

Guava is a  brilliant libraries . so many wizrds in it .  so i start off Deliberate practice with guava line by line .  
implementation details helps mastering skill  .   

CharMatcher.WHITESPACE's makes me doubted:  why WHITESPACE_MULTIPLIER is that value ? why change sequence of  WHITESPACE_TABLE  can't get MULTIPLIER (http://goo.gl/AGdkCu) .  can't find any information to understand it  by myself , may be this problem will douted other people 

that's all reason
 =||= _[Original comment](https://code.google.com/p/guava-libraries/issues/detail?id=1661#c6) posted by **magiciankid** on 2014-02-11 at 02:35 AM_

---

at this version (http://goo.gl/0YmP0L) documented very well  , the latest change was submit by ""Colin Decker""
 =||= _[Original comment](https://code.google.com/p/guava-libraries/issues/detail?id=1661#c7) posted by **lowasser@google.com** on 2014-02-18 at 07:21 PM_

---

We have a WhitespaceMatcherGenerator class that we could open-source; the main issue is that it depends on icu4j, which would be a new dependency for tests, and we may or may not be okay with adding that dependency.
 =||= _[Original comment](https://code.google.com/p/guava-libraries/issues/detail?id=1661#c8) posted by **magiciankid** on 2014-02-19 at 03:29 AM_

---

hmm , how about put it in wiki or comment it in someplace  , anticipate WhitespaceMatcherGenerator . 
 =||= I just came across this and had the same confusion. Unexplained magic numbers are confusing. You don't need formal comments, but a brief explanation would demystify the code. Something like this would suffice:

// TABLE is a precomputed hashset of whitespace characters. MULTIPLIER serves as a hash function
// whose key property is that it maps 25 characters into the 32-slot table without collision.
 =||= Fix mirroring out soon. =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Export new AtomicLongMapBasherTest to open-source repo.

https://github.com/google/guava/pull/3605#discussion_r324303026

704c08989c9c2c21b4e2cb0ab285a7d84ee0fc3f

-------

<p> Add @LazyInit and @RetainedWith annotations to the lazily calculated ""entries"" field of ImmutableSetMultimap.

This field is lazily evaluated by entries() without holding a lock, but multiple concurrent calls to entries() will produce idempotent results at the cost of some performance.

996369d89362e0ec93f7dd6e9a6860aa08858c80

-------

<p> Let ListenableFuture implement thenable via a default interface method in J2CL.

This is a second attempt after problems in e0bac74571b81756c4acf767e3ad186b7473a4f8 were fixed.

44909d9d5fc5b394c710a6b8b0d6c3786c765af5

-------

<p> Add test for behavior described in #1900

7329a66694d59bb22e2589eb9a2f620c98a881f9

-------

<p> Undo test CL 9a50815df26be7416be0fac489e29feee7a3c220.

It produces a tiny diff between the common.base and common.collect copies of AbstractIterator.

c82f7916879a46539a1e53ac98dda90e9c5537b8

-------

<p> Add Splitter.splitToStream().

6c984121f74d5cea97ac1ffabfe98938bc7c96c4

-------

<p> Add comment explaining TABLE and MULTIPLIER in CharMatcher.Whitespace

Fixes #1661

5430b140cae37b078fd4dda9b1a57a025664cfe1

-------

<p> Rollback of adding Splitter.splitToStream().

*** Reason for rollback ***

My guess is that this change somehow upsets an allowed list of
one-definition violations.

3f49efe9f00a2ed9dd3bd1cde1d5d596833b7391

-------

<p> Rollback of change to let ListenableFuture implement thenable via a default interface method in J2CL.

38c9a029e6cc538bcc46b9ad23fe03a62739d433

-------

<p> Clean up leftovers from MapMaker.makeComputingMap:

- Remove makeComputingMap from the GWT emulation.
- Deprecate ComputationException.

0b93365c2440981c04a94f6e5596d3f723549ea3"David P. Bakernetdpb09/23/19, 08:19:51 PM
3628.03629Update errorprone to 2.3.3Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Update errorprone to 2.3.3

Fixes #3628

c24688d4f69cc00d11de6d183c28bdf0a86a032a"Chris Povirkcpovirk10/01/19, 01:06:06 AM
3210.03635Quantiles.ScaleAndIndexes#computeInPlace throws an unexpected ArrayIndexOutOfBoundsException if the array indexes is empty"In `Quantiles.ScaleAndIndexes#computeInPlace`, if the array `indexes` of `Quantiles.ScaleAndIndexes` is empty, an unexpected `ArrayIndexOutOfBoundsException` is thrown.
The problem is if the last argument(`int[] indexes`) of `Quantiles.ScaleAndIndexes` constructor is length of 0, `computeInPlace` passes an invalid negative value as the third argument to the private method `selectAllInPlace` and causes the error. 

To reproduce, run this code:
```java
import com.google.common.math.Quantiles;
import java.util.Map;

public class EmptyIndexes {
   public static void main(String args[]) {
       int[] empty = {};
       int scale = 10;
       int[] dataset= {0, 1, 2, 3, 4, 5};

       Quantiles.ScaleAndIndexes sai = Quantiles.scale(scale).indexes(empty);
       Map<Integer, Double> map = sai.computeInPlace(datatset_double);
   }
}
```

The program throws `ArrayIndexOutOfBoundsException`.
This is an unfriendly error that can be easily fixed by using `checkArgument()` in constructor of `Quantiles.ScaleAndIndexes`. "Link to proposed fix: [PR #3211](https://github.com/google/guava/pull/3211) =||= Thanks for this, @NhatDinh , I guess we missed this error case. =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Check the array indexes in Quantiles.ScaleAndIndexes is non empty.

Fixes #3210
Fixes #3211

823a432ddaa2d274b539e12ed2bb46e5be0658ee

-------

<p> Simplify some code.

Fixes #3580

e2362def3408478a4a74d24671aef39171a1e93f

-------

<p> Document the JDK 9+ alternative to `Iterators#forEnumeration`

Fixes #3382

e432be553038b4c67f22abb8c27f82ab6d480f3d

-------

<p> Add a MIME type MPEG-DASH (mpd files)

Fixes #2677

RELNOTES=`net`: Added the `MediaType` constant for MPEG-DASH.

579ccf6c0181097be7b895ec145f04502234ef0e

-------

<p> Fix the logic that decides whether to use currentRequestThreadFactory() under App Engine.

While there, also support thread renaming under App Engine.

Fixes https://github.com/google/guava/issues/3598
Relevant to https://github.com/google/guava/issues/3606
(also, the CL in which I experimented with https://github.com/google/guava/issues/3569 before backing it out)

7bd4b2351c1483f34e7192768b4f3e7a10447c33"Chris Povirkcpovirk10/02/19, 04:48:52 PM
3211.03635Check the array indexes in Quantiles.ScaleAndIndexes is non emptyFix [Issue #3210 ](https://github.com/google/guava/issues/3210)"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here (e.g. `I signed it!`) and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

<!-- need_sender_cla --> =||= I signed it! =||= CLAs look good, thanks!

<!-- ok --> =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Check the array indexes in Quantiles.ScaleAndIndexes is non empty.

Fixes #3210
Fixes #3211

823a432ddaa2d274b539e12ed2bb46e5be0658ee

-------

<p> Simplify some code.

Fixes #3580

e2362def3408478a4a74d24671aef39171a1e93f

-------

<p> Document the JDK 9+ alternative to `Iterators#forEnumeration`

Fixes #3382

e432be553038b4c67f22abb8c27f82ab6d480f3d

-------

<p> Add a MIME type MPEG-DASH (mpd files)

Fixes #2677

RELNOTES=`net`: Added the `MediaType` constant for MPEG-DASH.

579ccf6c0181097be7b895ec145f04502234ef0e

-------

<p> Fix the logic that decides whether to use currentRequestThreadFactory() under App Engine.

While there, also support thread renaming under App Engine.

Fixes https://github.com/google/guava/issues/3598
Relevant to https://github.com/google/guava/issues/3606
(also, the CL in which I experimented with https://github.com/google/guava/issues/3569 before backing it out)

7bd4b2351c1483f34e7192768b4f3e7a10447c33"Chris Povirkcpovirk10/02/19, 04:48:52 PM
3580.03635Simplify some code"Remove some redundant 'if' statement.Besides, I use .toArray(new MyClass[0])  replace .toArray(new MyClass[myList.size()]) for improving the  efficiency  of the code.
https://stackoverflow.com/questions/174093/toarraynew-myclass0-or-toarraynew-myclassmylist-size""
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!`) and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3580) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3580) for more info**.

<!-- ok --> =||= -1 on the LocalCache changes, just as commented in PR #3492 this fixes what is presumably reported by an IDE at the expense of readability for no real reason.  =||= @ljacqu oh,sorry. I prefer the version that I commit because I would do the same thing in my daily coding.I can also understand that different projects have different coding styles. Do you mean that all the changes of 'if' statement is unnecessary? If you think so, I would revert them into the master version! =||= @ljacqu  I think that 'sum == 0' needs to be preserved because 'sum == 0' itself has the meaning of isEmpty. Positive thinking is more conducive to people's understanding than negative thinking.If you do not agree with that. I can also revert other 'if' statement to the master version.
Look forward to your reply. =||= Sorry if there was any misunderstanding, I‚Äòm not in any way affiliated/involved with Guava ‚Äì I just posted a comment as an individual passing by :) =||= @ljacqu  That‚Äôs all right.I am very glad that you can reply to this pr.Thanks for your suggestion =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Check the array indexes in Quantiles.ScaleAndIndexes is non empty.

Fixes #3210
Fixes #3211

823a432ddaa2d274b539e12ed2bb46e5be0658ee

-------

<p> Simplify some code.

Fixes #3580

e2362def3408478a4a74d24671aef39171a1e93f

-------

<p> Document the JDK 9+ alternative to `Iterators#forEnumeration`

Fixes #3382

e432be553038b4c67f22abb8c27f82ab6d480f3d

-------

<p> Add a MIME type MPEG-DASH (mpd files)

Fixes #2677

RELNOTES=`net`: Added the `MediaType` constant for MPEG-DASH.

579ccf6c0181097be7b895ec145f04502234ef0e

-------

<p> Fix the logic that decides whether to use currentRequestThreadFactory() under App Engine.

While there, also support thread renaming under App Engine.

Fixes https://github.com/google/guava/issues/3598
Relevant to https://github.com/google/guava/issues/3606
(also, the CL in which I experimented with https://github.com/google/guava/issues/3569 before backing it out)

7bd4b2351c1483f34e7192768b4f3e7a10447c33"Chris Povirkcpovirk10/02/19, 04:48:52 PM
3382.03635Document the JDK 9+ alternative to `Iterators#forEnumeration`"- Copied the phrasing from the various `Streams.stream(Optional*)` methods.
- Didn't update the documentation in the Android code base. (Which also mirrors the approach taken for the `Streams.stream(Optional*)` methods.)
- Not completely sure whether the `UnmodifiableIterator`/`Iterator` distinction is worth pointing out."The JDK 11 build failures are unrelated to this change. =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Check the array indexes in Quantiles.ScaleAndIndexes is non empty.

Fixes #3210
Fixes #3211

823a432ddaa2d274b539e12ed2bb46e5be0658ee

-------

<p> Simplify some code.

Fixes #3580

e2362def3408478a4a74d24671aef39171a1e93f

-------

<p> Document the JDK 9+ alternative to `Iterators#forEnumeration`

Fixes #3382

e432be553038b4c67f22abb8c27f82ab6d480f3d

-------

<p> Add a MIME type MPEG-DASH (mpd files)

Fixes #2677

RELNOTES=`net`: Added the `MediaType` constant for MPEG-DASH.

579ccf6c0181097be7b895ec145f04502234ef0e

-------

<p> Fix the logic that decides whether to use currentRequestThreadFactory() under App Engine.

While there, also support thread renaming under App Engine.

Fixes https://github.com/google/guava/issues/3598
Relevant to https://github.com/google/guava/issues/3606
(also, the CL in which I experimented with https://github.com/google/guava/issues/3569 before backing it out)

7bd4b2351c1483f34e7192768b4f3e7a10447c33"Chris Povirkcpovirk10/02/19, 04:48:52 PM
2677.03635Add a MIME type MPEG-DASH (mpd files)This format is becoming a thing. I couldn't find it in Guava's media types."Thanks for your pull request.  It looks like this may be your first contribution to a Google open source project. Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed, please reply here (e.g. `I signed it!`) and we'll verify.  Thanks.

---

- If you've already signed a CLA, it's possible we don't have your GitHub username or you're using a different email address.  Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
- If you signed the CLA as a corporation, please let us know the company's name.

<!-- need_sender_cla --> =||= I signed it! =||= CLAs look good, thanks!

<!-- ok --> =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Check the array indexes in Quantiles.ScaleAndIndexes is non empty.

Fixes #3210
Fixes #3211

823a432ddaa2d274b539e12ed2bb46e5be0658ee

-------

<p> Simplify some code.

Fixes #3580

e2362def3408478a4a74d24671aef39171a1e93f

-------

<p> Document the JDK 9+ alternative to `Iterators#forEnumeration`

Fixes #3382

e432be553038b4c67f22abb8c27f82ab6d480f3d

-------

<p> Add a MIME type MPEG-DASH (mpd files)

Fixes #2677

RELNOTES=`net`: Added the `MediaType` constant for MPEG-DASH.

579ccf6c0181097be7b895ec145f04502234ef0e

-------

<p> Fix the logic that decides whether to use currentRequestThreadFactory() under App Engine.

While there, also support thread renaming under App Engine.

Fixes https://github.com/google/guava/issues/3598
Relevant to https://github.com/google/guava/issues/3606
(also, the CL in which I experimented with https://github.com/google/guava/issues/3569 before backing it out)

7bd4b2351c1483f34e7192768b4f3e7a10447c33"Chris Povirkcpovirk10/02/19, 04:48:52 PM
3453.03636Add testlib readmeMoe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add testlib readme.

Fixes #3453

3b0f1e580b4e0bde8fd4806c832389d0aade4063

-------

<p> Change Quantiles' compute() methods for multiple indexes to return a map with entries in the order in which the indexes were provided in the call to indexes().

Fixes https://github.com/google/guava/pull/2989

RELNOTES=`math`: `Quantiles` `compute()` methods which return a `Map` now return a map with entries in the same order in which the indexes were provided.

6a2d070ac268c138d6ad039605de54f535d5f5f3"Chris Povirkcpovirk10/02/19, 05:48:45 PM
3633.03637Code improvement `if` statement instead of a for `statement` to a single item"Code improvement, using `if` statement instead of a for `statement` to a single item.

I also found some classes with empty methods that are not being used by the project, is this correct? If these methods can be removed, I'd like to open a pr for this.

ex: `AllEqualOrdering_CustomFieldSerializer.deserialize(SerializationStreamReader reader, AllEqualOrdering instance)`""
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3633) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3633) for more info**.

<!-- ok --> =||= Thanks.

The `CustomFieldSerializer` methods are used through reflection by [GWT](http://www.gwtproject.org) during its GWT-RPC serialization. (We're actually removing support for that at the beginning of next year, but we'll take care of it then.) =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Bump version, which went out of date since the previous CL was created.

90f4a1c88941d1d68ec2fc68397a5e11fefa7355

-------

<p> Use if statement instead of for statement for a single item.

Fixes #3633

020621e474e228b4b9c12dbd24badd9590b0af8e

-------

<p> Upgrade maven source plugin from 2.1.2 to 3.1.0

Fixes https://github.com/google/guava/pull/3466

e87b8807798808d5a526a6fd2f49b484bb4a846a

-------

<p> Document the JDK 9+ alternative to `MoreObjects#firstNonNull`

Fixes https://github.com/google/guava/pull/3383

145da12d85b536d6f2a527e1ccf2430147fa6b83"Chris Povirkcpovirk10/02/19, 09:34:36 PM
3652.03654switch to an internal annotation for ignoring JRE requirements@cpovirk This completely removes the dependency on animal-sniffer annotations(Thanks!) =||= Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> switch to an internal annotation for ignoring JRE
requirements

Fixes #3652

RELNOTES=Removed dependency on `animal-sniffer-annotations`.

3324ce6af9d672b4a1e4431ebaf84b0e22d7ca86

-------

<p> Rename package-private Duration APIs:
  saturatedToNanos() -> toNanosSaturated()
  saturatedToMillis() -> toMillisSaturated()

#goodtime

f3a053ea12ae808ddd52094d36fcd88fe95881f2

-------

<p> Suppress more GoodTime errors.

9e885c85265c3686aa876acebe6bb6bda18de1f3"Nicknick-someone10/11/19, 01:53:35 PM
3653.03656update failureaccess version to match docs with code"@cpovirk fix #3651 

Other uses of 1.0.0 are in `@since` tags"Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Log warnings for users who send Guava types over GWT-RPC.

(Roll forward CL 273803350, which was rolled back in CL 273825377. This time with updates to one-definition whitelist.)

[]

09a11ae36f186ba1ed5b0cd4d9eef2733028c496

-------

<p> update failureaccess version to match docs with code

Fixes #3653

dc01afd344fdf669f28e9e806dc8864622152177"Kurt Alfred Klueverkluever10/14/19, 07:43:51 PM
3561.03666Improve ImmutableList#of Javadoc- link to the JDK equivalent Collections#singletonList rather than Collections#singleton (which returns a Set)"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!`) and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3561) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3561) for more info**.

<!-- ok --> =||= Thanks! We're going to merge this internally, and it should be synced out tomorrow. =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix ImmutableList#of Javadoc

Fixes #3561

a14d317807e63770c5e57a4307cd1e69ea233ba0

-------

<p> Attempt to fix inheriting Javadoc from the JDK again.

It's currently missing:
https://guava.dev/releases/snapshot-jre/api/docs/com/google/common/primitives/UnsignedInteger.html#equals-java.lang.Object-

But I haven't managed to reproduce the problem locally.

I'm trying this on the theory that java.home might be pointing to the JDK (the top-level directory in which src.zip lives) rather than the JRE (a subdirectory).

Note that JDK11 has src.zip in a lib/ subdirectory. I tried adding it to a Java 11 build of Guava, but things blew up because the JDK contains module declarations, which naturally are incompatible with our -source 8. Possibly the right fix there is to avoid -source 8 in favor of the approach I used for jimfs in CL 272937179 -- except that maybe I already tried that and it wasn't sufficient? I'm happy to punt on that for now, especially since I just tried removing -source 8 and got a bunch of ""too many module declarations found"" errors :)

4c83832db7e6ae8d0cd351fac7fe28f4116ef0de"Colin Deckercgdecker10/22/19, 03:47:51 PM
3673.03674Update 'adding Guava to your build using Gradle' snippet"Hello from Gradle üëã 

I noticed that the 'adding Guava to your build using Gradle' section in the README could use an update. So here it is.

The notation with brackets - () - and double quotes - "" - is valid in both Gradle's Groovy and Kotlin DSL. The keyword (the 'configuration') determines the scopes in which  the dependency is visible. ""compile"" is already discouraged since some time and officially deprecated with Gradle 6. ""implementation"" and ""api"" are both possible, but the initial recommendation for using a
library should be ""implementation"".

https://docs.gradle.org/6.0-rc-1/userguide/java_library_plugin.html#sec:java_library_recognizing_dependencies""Thanks! It sounds like we should definitely be moving off `compile` at this point.

In the past, though, we've heard people (@tbroyer, @JakeWharton) suggest that `api` makes a safer default than `implementation`:
- https://github.com/google/guava/pull/3154
- https://github.com/google/auto/issues/620

(The Auto discussion touches on [especially controversial issues around annotations](https://github.com/google/auto/pull/765#discussion_r330655031), which might be a distraction from the more common case -- though Guava does include annotations, too!)

Even if we do give `api` as a ""default"" recommendation, I can certainly see _mentioning_ `implementation`, ideally by saying something like:
> If you can make _certain guarantees_ \[link\], then you can change `api` to `implementation` to let Gradle skip work in some cases.

...

OK, and now I actually went and read the docs you linked to :) (Thanks!) I see how `implementation` has its advantages beyond build speed.

I'll revise what I said above to something more like ""It's complicated"" :) I'm now not sure it makes sense to give _either_ recommendation as a ""default.""

I would be tempted to put:

> <pre>
> dependencies {
>   <i>some-configuration</i>(""com.google.guava:guava:28.1-jre"")
>   // or, for Android:
>   <i>some-configuration</i>(""com.google.guava:guava:28.1-android"")
> }
> </pre>
> ...where <i>some-configuration</i> is either `implementation` or `api`, as discussed [in the Gradle docs](https://docs.gradle.org/6.0-rc-1/userguide/java_library_plugin.html#sec:java_library_recognizing_dependencies).

Thoughts on that? =||= Thanks for the quick response @cpovirk. I wasn't aware that there is such a history in discussing this little snippet. :) And of course it depends a lot on whom you ask what the more sensible default is. From our side, we prefer recommending ""implementation"" because the user will have to make the explicit decision to expose it, if they are developing a library/module used by others. But I can also understand the ""some users just want it to work as before/as in Maven"" argument.

The downside of the ""some-configuration"" would be that it looses it's nice ""copy&paste"" character. Also in theory it makes sense as there are even more configurations you can use.

How about adding both?
```
dependencies {
  // Use Guava in your implementation
  implementation(""com.google.guava:guava:28.1-jre"")
  // Use Guava types in your public API
  api(""com.google.guava:guava:28.1-jre"")
  // Android: Use Guava in your implementation
  implementation(""com.google.guava:guava:28.1-android"")
  // Android: Use Guava types in your public API
  api(""com.google.guava:guava:28.1-android"")
}
```
 The comments are vastly simplifying the effect, but give a rough guidance for users who absolutely have no idea.
 =||= I am encouraged enough by tbroyer's thumbs-up to move on to tweaking wording :)

> ```gradle
> dependencies {
>   // Use Guava in your implementation only:
>   implementation(""com.google.guava:guava:28.1-jre"")
>   // OR: Use Guava types in your public API:
>   api(""com.google.guava:guava:28.1-jre"")
> ```
> 
> Or, for Android:
> 
> ```gradle
> dependencies {
>   // Use Guava in your implementation only:
>   implementation(""com.google.guava:guava:28.1-android"")
>   // OR: Use Guava types in your public API:
>   api(""com.google.guava:guava:28.1-android"")
> }
> ```

But maybe that separates the Android and non-Android cases too widely? Plus, we'd probably want to do the same for Maven, which is more verbose, so we'd end up with 4 code blocks, some of them large :\

> ```gradle
> dependencies {
>   // Use Guava in your implementation only:
>   implementation(""com.google.guava:guava:28.1-jre"")
>   // OR: Use Guava types in your public API:
>   api(""com.google.guava:guava:28.1-jre"")
> }
>
> // Or, for Android:
> 
> dependencies {
>   // Use Guava in your implementation only:
>   implementation(""com.google.guava:guava:28.1-android"")
>   // OR: Use Guava types in your public API:
>   api(""com.google.guava:guava:28.1-android"")
> }
> ```

That would mean only 2 code blocks (Gradle and Maven), and maybe we can get away with keeping the Maven one as it is?

I don't know, or:

> ```gradle
> dependencies {
>   // Pick one:
>
>   // 1. Use Guava in your implementation only:
>   implementation(""com.google.guava:guava:28.1-jre"")
>
>   // 2. Use Guava types in your public API:
>   api(""com.google.guava:guava:28.1-jre"")
>
>   // 3. Android - Use Guava in your implementation only:
>   implementation(""com.google.guava:guava:28.1-android"")
>
>   // 4. Android - Use Guava types in your public API:
>   api(""com.google.guava:guava:28.1-android"")
> }
> ```

Maybe I like that one?

(Whatever we do, we should link to the nice Gradle docs.) =||= I also like the last suggestion. With the newlines in between it's more readable than what I suggested. I think it's good to keep having one block for Maven and one for Gradle. Then it's easier to spot that each is about one tool.

Below the listing we can add a sentences like:

For more information on when to use `api` and when to use `implementation`, consult the [Gradle documentation on  API and implementation separation](https://docs.gradle.org/current/userguide/java_library_plugin.html#sec:java_library_separation) =||= Sounds good to me. Want to update the PR to that, and I can import it? =||= Done! Thanks @cpovirk! =||= "Moe Sync"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Rollback

*** Reason for rollback ***

Didn't work: https://guava.dev/releases/snapshot-jre/api/docs/com/google/common/primitives/UnsignedInteger.html#equals-java.lang.Object-

*** Original change description ***

Attempt to fix inheriting Javadoc from the JDK again.

It's currently missing:
https://guava.dev/releases/snapshot-jre/api/docs/com/google/common/primitives/UnsignedInteger.html#equals-java.lang.Object-

But I haven't managed to reproduce the problem locally.

I'm trying this on the theory that java.home might be pointing to the JDK (the top-level directory in which src.zip lives) rather than the JRE (a subdirectory).

Note that JDK11 has src.zip in a lib/ subdirectory. I tried adding it to a Ja...

***

5b6537baac6ae0569b9411e578c8d37f75cc716a

-------

<p> Update 'adding Guava to your build using Gradle' snippet

The notation with brackets - () - and double quotes - "" - is valid
in both Gradle's Groovy and Kotlin DSL.

The ""compile"" configuration is already discouraged since some time and
officially deprecated with Gradle 6.

Fixes #3673

f4866c6d50df1551a75986b1bb5d34b9245634d1

-------

<p> Format README.md.

c850b5742a68be52b5d08a7fdf544627088beb4d"Colin Deckercgdecker10/28/19, 02:49:44 PM
3507.03677Update Javadoc of UnsignedBytes.java"UnsignedBytes ```min()``` and ```max()``` method treat its parameter as unsigned and returns the least and greatest value also too as unsigned respectively. It should be updated in the Javadoc.

Test Case:-

Input:-
```
import com.google.common.primitives.UnsignedBytes;

class ex{
    static void pr(byte []a) {
        System.out.println(UnsignedBytes.min(a)); // 10 is less than -100 when treated as unsigned
        System.out.println(UnsignedBytes.max(a)); // -100 is greater than 10 when treated as unsigned
    }
    public static void main(String[] args) {
        byte []a={-100,10};
        pr(a);
    }
}
```
Run it by typing in the terminal:-
```
javac ex.java
java ex
```
Output:-
```
10
-100
```""
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here (e.g. `I signed it!`) and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3507) for more info**.

<!-- need_sender_cla --> =||= > Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).
> 
>  **Please visit https://cla.developers.google.com/ to sign.**
> 
> Once you've signed (or fixed any issues), please reply here (e.g. `I signed it!`) and we'll verify it.
> 
> #### What to do if you already signed the CLA
> ##### Individual signers
> * It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
> 
> ##### Corporate signers
> * Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
> * The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
> * The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
> 
>  **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3507) for more info**.

```I signed it!``` =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3507) for more info**.

<!-- ok --> =||= It looks like we do mention unsignedness in the Javadoc of other methods on the class, so this seems reasonable. I'll try to get this submitted internally soon (with a couple small modifications). =||= "MOE Sync 2019-10-31"This code has been reviewed and submitted internally. Feel free to discuss on the PR and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix toString exception handling change from 957c37116fb2cc52b2f8b405871b65a84917f2ca.

This is not an ideal code fix but it restores the previous functionality and adds a test that verifies the exception handling logic.

82b7589dfbfc5f2b6f68d6a6a1bb34e4633f4f3c

-------

<p> Handle StackOverflowError from both pendingToString and appendUserObject.

Adds a bunch of tests to validate error handling in toString code
- Verify that a future completing during the toString call results in a done formatted string
- Verify that an exception thrown by pendingToString doesn't cause toString to fail
- Verify that cycles don't cause toString to fail
- Verify that deep chains of SetFuture don't cause toString to fail

RELNOTES=Catch StackOverflowError in AbstractFuture.toString to prevent long chains of futures from failing toString calls.

29981d416d6b4214e65360ad3d932ba0881a4c8f

-------

<p> Update Documentation

Fixes #3507

8a0d6bb345341fc0ba91781070da5b522d4b714b"David P. Bakernetdpb10/31/19, 08:40:18 PM
3565.03684Remove usages of deprecated CharMatcher functions"Methods like charMatcher.digit() or javaLetterDigit() which would match digit and digit or letters in string is being deprecated by guava. Such methods are replace by inRange methods. For example, instead of digit(), it would be inRange('0', '9').

This PR closes #3544.""
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!`) and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google.com/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3565) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= We found a Contributor License Agreement for you (the sender of this pull request), but were unable to find agreements for all the commit author(s) or Co-authors.  If you authored these, maybe you used a different email address in the git commits than was used to sign the CLA ([login here](https://cla.developers.google.com/) to double check)?  If these were authored by someone else, then they will need to sign a CLA as well, and confirm that they're okay with these being contributed to Google.
In order to pass this check, please resolve this problem and then comment `@googlebot I fixed it.`. If the bot doesn't comment, it means it doesn't think anything has changed.

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3565) for more info**.

<!-- need_author_cla --> =||= @googlebot I fixed it. =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3565) for more info**.

<!-- ok --> =||= "MOE Sync 2019-11-06"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add @SuppressWarnings(""DoNotMock"") to mocked com.google.common types

@DoNotMock will be added to these types. This change suppresses warnings for current cases where these types are mocked.

13ed6d3846bb3765b19ec06819a215ae93644b6c

-------

<p> Add GraphBuilder.incidentEdgeOrder().

2c1db61cfae457a58554f4390c3907f18f406b6a

-------

<p> Remove usages of deprecated CharMatcher functions

Fixes #3565

213ec90d8647412c4d25870fbc1c8bb3a44798ff

-------

<p> Have ImmutableGraph.Builder set incidentEdgeOrder to stable().

c43a2bf57ccc089bb64f2704321e175a611cdc4b

-------

<p> Migrate org.mockito.Matchers#any* to org.mockito.ArgumentMatchers

The former is deprecated and replaced by the latter in Mockito 2. However, there is a
functional difference: ArgumentMatchers will reject `null` and check the type
if the matcher specified a type (e.g. `any(Class)` or `anyInt()`). `any()` will
remain to accept anything.

All remaining `any(Class)` references are migrated to `nulllable(Class)` to maintain the functionality of Mockito 1.
All remaining `anyString()` references are migrated to `nullable(String.class)` to maintain the functionality of Mockito 1.

3e96e06575ea0bb1e8be61ce2edd57ac9427c71d"Kurt Alfred Klueverkluever11/07/19, 01:26:46 AM
3706.03710checker-qual 2.10.0MOE Sync 2019-11-18"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> checker-qual 2.10.0

Fixes #3706

8f2ec6330b05f156985dd0c9dc2acebbb8a711c2"Nicknick-someone11/18/19, 04:13:57 PM
3745.03748Refactor Lambda can be replaced method reference"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3745) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3745) for more info**.

<!-- ok --> =||= "MOE Sync 2019-12-23"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> refactor: Lambda can be replaced method reference

Fixes #3745

1d8ab4f96855dcb9a7cd3990a671f4e5696faa4e"Chris Povirkcpovirk12/23/19, 06:49:46 PM
3761.03765Fix off-by-one error in AsciiDigits.asciiDigits initialization"`AsciiDigits.digit('[')` should return -1 instead of 36.

I changed both loops to consistently use strict inequalities. Now it's clear that there are 10 + 26 = 36 digits / iterations in total.

Fortunately this bug doesn't affect anything other than `Longs.tryParse` where it is - by accident - harmless.

https://github.com/google/guava/blob/v28.2/guava/src/com/google/common/primitives/Longs.java#L405
https://github.com/google/guava/blob/v28.2/guava/src/com/google/common/primitives/Longs.java#L414

Note that `Longs.tryParse('[', 36)` and `Longs.tryParse('0[', 36)` currently return `null` because of `digit >= radix` condition, not `digit < 0` as it should be.

""I said about '[' = 'A' + 26 = 'Z' + 1, but I forgot to mention '{' = 'a' + 26 = 'z' + 1. Just for the record.
 =||= "MOE Sync 2020-01-08"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add test case stable incidentEdgeOrder with a self loop to AbstractStandard[Un]directedGraphTest.

aee54682770a3166c231bbfecced91f31c55d32a

-------

<p> Add test for stable incidentEdgeOrder support for mutable undirected valuegraphs in ValueGraphTest

0aba85dd247e254e10fcd84e7b2940fa0383e14e

-------

<p> Fix off-by-one error in AsciiDigits.asciiDigits initialization.

Fixes #3761.

2b27d9f906e18ae1105766d41e0940122ce686a0

-------

<p> Disable GWT-RPC by default in the open-source release.

RELNOTES=[Guava types can no longer be sent over GWT-RPC.](https://groups.google.com/d/msg/guava-announce/zHZTFg7YF3o/rQNnwdHeEwAJ) To _temporarily_ reenable support, set the `guava.gwt.emergency_reenable_rpc` system property to `true`.

ff0cd947f82d24611e39fb3d86e3d19da4af801f"David P. Bakernetdpb01/09/20, 03:25:27 PM
3788.03796Make AbstractFuture compatible with ForkJoinPool by catching exceptions from property retrievalContext: https://github.com/google/guava/issues/3784"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3788) for more info**.

<!-- need_sender_cla --> =||=  I submitted the corporate CLA on behalf of Snowflake, but I need our authorized signer (our VP) to click through the agreement still. Once that happens, I'll trigger the cla/google check again. =||= Hmm is there a way to see the test outputs for Travis CI? The log indicates that the new test fails, but I don't see that `/home/travis/build/google/guava/guava-tests/target/surefire-reports` is made available anywhere... =||= On [the job log page](https://travis-ci.org/google/guava/jobs/643496489), you can scroll _way_ to the bottom and click the `$ util/print_surefire_reports.sh` line and -- I see that it's not working :( I will have a look. Sorry about that. =||= Odd. It works for me locally (also maven-surefire-plugin:2.7.2, though only Maven 3.5). I wonder what's different about Travis.

If you're lucky, the problem will reproduce for you locally:
`mvn clean install ""-Dtest.include=**/AbstractFutureInnocuousThreadTest.java""`

(You can probably skip the `clean` part, but I am always nervous about doing so.) =||= OK, I patched in your PR, so I have updates on 2 fronts:

First, the failure is this:

```
testAbstractFutureInitializationWithInnocuousThread_doesNotThrow(com.google.common.util.concurrent.AbstractFutureInnocuousThreadTest)  Time elapsed: 0.151 sec  <<< ERROR!
java.security.AccessControlException: access denied (""java.lang.RuntimePermission"" ""closeClassLoader"")
  at java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)
  at java.security.AccessController.checkPermission(AccessController.java:884)
  at java.lang.SecurityManager.checkPermission(SecurityManager.java:549)
  at java.net.URLClassLoader.close(URLClassLoader.java:289)
  at com.google.common.util.concurrent.AbstractFutureInnocuousThreadTest.tearDown(AbstractFutureInnocuousThreadTest.java:80)
...
```

I am able to reproduce it locally -- but _not_ when using the `test.include` flag from my previous post. It's possible that this means that your test is affected by a previous test's incomplete cleanup or other poor hygiene (`AbstractFutureFallbackAtomicHelperTest`? `AbstractFutureCancellationCauseTest`?).

Second, I'm not completely sure what's up with `util/print_surefire_reports.sh`. Locally, I get a ""successful"" run but with no results with your commit patched in. That's because I'm seeing `.xml` files for most tests but _not_ seeing one for _your_ test. Maybe that's related to the `SecurityManager`?

I don't know why the situation would be different under Travis, under which there are apparently _no_ `.xml` files.... =||= Now I am more confused!

In an attempt to narrow down which tests were causing the problem, I ran:
`mvn clean install ""-Dtest.include=%regex[.*util.concurrent.*.class]""`

That got this far:
```
Running com.google.common.util.concurrent.AbstractExecutionThreadServiceTest
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.09 sec
Running com.google.common.util.concurrent.AbstractFutureCancellationCauseTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.042 sec
Running com.google.common.util.concurrent.AbstractFutureFallbackAtomicHelperTest
Tests run: 42, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 33.034 sec
Running com.google.common.util.concurrent.AbstractFutureInnocuousThreadTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.073 sec
```

Those all appear to be successes. But then the run aborted, claiming:
```
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.7.2:test (default-test) on project guava-tests: There are test failures.
```

So I'm not sure what's up. Hopefully it will be clearer to you from the code. =||= Thanks for taking a look! I wonder if resetting the `SecurityManager` to its original state at the end of the test would fix the problem...I'll give that a shot locally without the test filter and then see if it passes, then see if another Travis run will succeed. =||= I really wish I could see the test output from Travis...I tried resetting the `SecurityManager` with `System.setSecurityManager(null);` at the end of the test, and both `mvn clean install ""-Dtest.include=%regex[.*util.concurrent.*.class]""` and `mvn clean install ""-Dtest.include=**/AbstractFutureInnocuousThreadTest.java""` pass for me now, but it looks like the tests through Travis are still failing based on the result above :(

Is `/home/travis/build/google/guava/guava-tests/target/surefire-reports` kept around in any logs/outputs? =||= Let's check on the CLA status at least, since we submitted the corporate one:

@googlebot I signed it! =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3788) for more info**.

<!-- ok --> =||= Woohoo, the CLA check passes now.

Separately, though, I found a way to avoid depending on `ForkJoinPool` within Arrow Flight, so it's fine if `AbstractFuture` tries to access properties, and I'm not blocked on this PR any more. I'm happy to try to see it to completion, but it's not urgent in any case. =||= Thanks! I grabbed your test and tweaked it to use a custom `SecurityManager` subclass instead of writing a policy file. That appears to be enough to get `mvn clean install` to pass. Do you have any comments on the result, https://github.com/google/guava/pull/3795? =||= (You can ignore the second copy of the files (from the `android` directory). I probably should have omitted that copy from the PR.) =||= Nice, LGTM! Thanks for figuring out a way to make it work. It sounds like this project doesn't merge changes from Github anyway, so we can close this PR if you want to proceed with submitting your version to google3 (and then I'm assuming the changes get exported to Github at some point). =||= Right, we'll make the equivalent change internally and then mirror it back out (with your name attached). That will automatically close this PR, so we can keep it open just in case I somehow forget about it :) =||= "MOE Sync 2020-02-06"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Make AbstractFuture compatible with ForkJoinPool by catching exceptions from property retrieval.

Fixes #3788, #3784

RELNOTES=Made it safe to load the `AbstractFuture` class from a `ForkJoinPool` thread under a security manager.

e589b5c884a5996f7040ae38bdf02709f9e300da"Chris Povirkcpovirk02/07/20, 02:44:29 AM
3784.03796AbstractFuture and ForkJoinPool are incompatible with SecurityManager"I was bitten by the issue described in https://stackoverflow.com/a/31052486/6253347 \[cpovirk adds (for searchability): might https://stackoverflow.com/q/55333290/28465 also be similar?\] when trying to use Arrow Flight with Java's SecurityManager, since `AbstractFuture` tries to check a property as part of initialization and hence can't be created from an `InnocuousThread` that doesn't have any privileges. The exception looks like this:

```
Caused by: java.security.AccessControlException: access denied (""java.util.PropertyPermission"" ""guava.concurrent.generate_cancellation_cause"" ""read"")
	at java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)
	at java.base/java.security.AccessController.checkPermission(AccessController.java:1044)
	at java.base/java.lang.SecurityManager.checkPermission(SecurityManager.java:408)
	at java.base/java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1152)
	at java.base/java.lang.System.getProperty(System.java:880)
	at com.google.common.util.concurrent.AbstractFuture.<clinit>(AbstractFuture.java:64)
```

I can try to put together a small repro if it's useful, but the TL;DR is that I'd like to wrap the call at https://github.com/google/guava/blob/master/guava/src/com/google/common/util/concurrent/AbstractFuture.java#L74 in a try/catch, since it will throw if access to system properties is not permitted by the SecurityManager.""Thanks, that sounds great. If you'd like to put together a pull request, you're welcome to (though note that it will require [you or your company to sign the CLA](https://github.com/google/guava/blob/master/CONTRIBUTING.md#contributor-license-agreement)). =||= Sorry, accidentally submitted early. The other thing I wanted to do was link to [a test that loads its own copy of `AbstractFuture`](https://github.com/google/guava/blob/66c2f795f2cbc90e104dde9d73ceb484b184b34b/guava-tests/test/com/google/common/util/concurrent/AbstractFutureCancellationCauseTest.java#L45). That would be the ideal test here, since it easily can run in the same VM as the rest of our tests. Alternatively, we could probably get away with a separate test class that we configure to run in a separate VM. =||= Thanks for the pointer! Do you think it would be okay to configure `AbstractFutureCancellationCauseTest` to use `SecurityManager` by default, or should I create a separate test file? Which directory does it make sense to put the policy file in?

I'm working on something more polished and looking into the CLA, but I was able to reproduce the failure by creating a hacky test like this:

```
  public void testInnocuousThreadWithAbstractFuture() throws Exception {
    AtomicBoolean success = new AtomicBoolean(false);
    Thread thread = jdk.internal.misc.InnocuousThread.newThread(
      () -> {
        try {
          Future<?> future = newFutureInstance();
          assertTrue(future.cancel(false));
          assertTrue(future.isCancelled());
          success.set(true);
        } catch (Exception e) {
          fail(""Unexpected exception: "" + e.toString());
        }
      });
    thread.start();
    thread.join();
    assertTrue(success.get());
  }
```

The cumbersome part, though, is that you have to set up a SecurityManager profile and pass some additional command-line arguments. I made a permissive policy like this:

```
grant {
  permission java.io.FilePermission ""/-"", ""read"";
  permission java.util.PropertyPermission ""*"", ""read,write"";
  permission java.lang.reflect.ReflectPermission ""*"";
  permission java.lang.RuntimePermission ""*"";
};
```

And then used these command-line arguments to Java:
```
-Djava.security.manager -Djava.security.policy=/path/to/java.policy -Djava.security.debug=access,failure --add-opens java.base/jdk.internal.misc=ALL-UNNAMED
```

The test fails since `success.set(true);` is never reached, and the test output has:

```
access: access denied (""java.util.PropertyPermission"" ""guava.concurrent.generate_cancellation_cause"" ""read"")
java.lang.Exception: Stack trace
	at java.base/java.lang.Thread.dumpStack(Thread.java:1383)
	at java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:462)
	at java.base/java.security.AccessController.checkPermission(AccessController.java:1044)
	at java.base/java.lang.SecurityManager.checkPermission(SecurityManager.java:408)
	at java.base/java.lang.SecurityManager.checkPropertyAccess(SecurityManager.java:1152)
	at java.base/java.lang.System.getProperty(System.java:880)
	at com.google.common.util.concurrent.AbstractFuture.<clinit>(AbstractFuture.java:74)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:567)
	at com.google.common.util.concurrent.AbstractFutureCancellationCauseTest.newFutureInstance(AbstractFutureCancellationCauseTest.java:187)
	at com.google.common.util.concurrent.AbstractFutureCancellationCauseTest.lambda$testInnocuousThreadWithAbstractFuture$0(AbstractFutureCancellationCauseTest.java:171)
	at java.base/java.lang.Thread.run(Thread.java:835)
	at java.base/jdk.internal.misc.InnocuousThread.run(InnocuousThread.java:134)
```

It should be possible to have the test use `java.util.concurrent.ForkJoinPool` rather than relying on the internal `InnocuousThread` class, but at least I was able to get a PoC working. =||= I was thinking more along the lines of a separate test class (though using the same classloading trick). I'm hoping that we don't need a separate policy file, given our ability to implement our own `SecurityManager`, as in [this test](https://github.com/google/guava/blob/66c2f795f2cbc90e104dde9d73ceb484b184b34b/guava-tests/test/com/google/common/reflect/ClassPathTest.java#L501). =||= Sent https://github.com/google/guava/pull/3788; comments welcome! =||= "MOE Sync 2020-02-06"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Make AbstractFuture compatible with ForkJoinPool by catching exceptions from property retrieval.

Fixes #3788, #3784

RELNOTES=Made it safe to load the `AbstractFuture` class from a `ForkJoinPool` thread under a security manager.

e589b5c884a5996f7040ae38bdf02709f9e300da"Chris Povirkcpovirk02/07/20, 02:44:29 AM
3800.03805Simplify redundant `Collection.addALl()` callSimplify redundant `Collection.addALl()` call and Optimize performance."
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3800) for more info**.

<!-- need_sender_cla --> =||= @googlebot  I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3800) for more info**.

<!-- ok --> =||= A couple quick thoughts, since I sadly doubt that I'll be able to dedicate a lot of time to this:

- I somewhat like to create the collection on one line and add to it on another _if_ I am then going to also _remove_ from it (or add more to it), like [here](https://github.com/google/guava/pull/3800/files#diff-f23f8f184b38c696a270e2e0ae0114eeL172). The multi-line process is a hint that there's going to be more to the collection than just its initial contents. That is, we're not just making a defensive copy. However, this is a minor point, and others might not see it that way. Plus, we're usually modifying the collection _immediately_ after creating, so there's not much danger of confusion.

- For cases in which we add objects and then add more objects, I'm not sure that we necessarily improve performance by presizing to the size of the _first_ set of objects, like [here](https://github.com/google/guava/pull/3800/files#diff-c0a860430c2be8897c12525322b7fda5R491). It might actually be better to accept the default size.

The unfortunate thing is that this code does need some performance tuning and general cleaning. I just fear that it would be a big investment. =||= Thanks for your code review. This PR was submitted for the following reasons : 
* Using the constructor with parameter, it can save one time array copy.
* Improving readability and polishing the code.

But I agree with your thoughts : 
* For the contextual semantic unity in a block of code.
* The performance improvement may be small.
* More time can be allocated for implementing features and fixing bugs

I respect your decision, so what should I do? =||= Thanks. I'm going to skip `DerivedCollectionGenerators.java`, since I'm not sure if that will help or hurt performance. (I notice that that code could probably be simplified even further, but I left it alone.) I'm looking to merge the rest. =||= "MOE Sync 2020-02-23"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Simplify redundant `Collection.addAll()` calls.

Fixes #3800

ae564a1d7c39704e800f04cef427f4c8abd6f010"Kurt Alfred Klueverkluever02/23/20, 10:51:09 PM
3829.03830Fixed double slicing ByteSource #3501As previous PR has commit should not occur. So I submit a new PR and add a test.MOE Sync 2020-03-19"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fixed double slicing ByteSource (#3501).

Fixes #3829

6fb7746b8bc39d4d547a1b2bb47549c6b8314af4"Chris Povirkcpovirk03/19/20, 04:56:44 PM
3816.03831Add UTs for base64Url() decode in BaseEncoding"I use base64Url in code if Gerrit to make the base64 URL safe.

But found that it doesn't cover some basic cases. "MOE Sync 2020-03-20"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add some unit tests for base64Url() in BaseEncoding

Fixes #3816

e1c08a80e340efb4477dd601d6073936cc67617f"Chris Povirkcpovirk03/20/20, 09:49:54 PM
3806.03856Remove @Beta from Service and ServiceManager"This leaves AbstractListeningExecutorService as @Beta.

Closes: https://github.com/google/guava/issues/3418"MOE Sync 2020-04-10"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Remove `@Beta` from `Service` and `ServiceManager`.

This leaves `AbstractListeningExecutorService` as `@Beta`.

Fixes #3806, #3418
Relevant to #2966

(I have tweaked Jesse's initial PR to leave `AbstractExecutionThreadService.triggerShutdown` and `AbstractService.doCancelStart` as `@Beta`, since we aren't sure we like the locking behavior of the former, and we've realized that `Listener.stopping` _might_ be a reasonable substitute for both.)

RELNOTES=`util.concurrent`: Removed `@Beta` from `Service` and related classes.

33574d771b099991822ed78a726df0eea4646eea"Chris Povirkcpovirk04/10/20, 03:45:52 PM
3418.03856Remove @Beta from Service and ServiceManager"- In Service, it looks like it might be nice to use Duration instead of (long, TimeUnit), but I'm not sure we're ready to take that plunge soon enough to worry about it -- and of course we want most people to run through ServiceManager (where we can add such overloads) anyway.

(Rumor has it that Jesse Wilson might be interested in this.)""Any idea if this will happen? I've been using this API, and I'd love to see the Beta removed from it. =||= I am interested in this. =||= It looks like `java.time` overloads have been added. Is this reasonable now, @cpovirk? =||= It's been on my list of items for the new issue-planning process. I've tied up the other few issues I was looking at, so this can be next. =||= Other open issues related to `Service`:
- Services that are stopped cannot be restarted #418 
- AbstractService needs functionality to triggerShutdown or interrupt running Tasks. #1918
- RaceCondition with AbstractExecutionThreadService? #2966
- Feature Request: allow specifying dependencies in ServiceManager #1406
- Feature Request: add logging to ServiceManager.stopAsync #1405
- Add Service.State.isTerminal() #2403

Most of these look like features we could add after finalizing the existing API. The main exception is permitting restarting services, but that is a big enough change that we are unlikely to ever change the core `Service` classes for it, even when they are still `@Beta` APIs. (We may still provide some other way to emulate restartable services, just one that doesn't touch the core API.) =||= On the `Duration` front, we might wish that `AbstractScheduledService.CustomScheduler` were the name of the `Duration`-based API, rather than the `long, TimeUnit`-based (i.e., `Schedule`-based) API. But since that name is taken for the latter, we're likely to pick a clumsier name for the `Duration`-based method. But I'm not sure a rename of the existing API would be worth the trouble, especially since many Android users can't easily use `Duration` yet. =||= Also: I noticed recently that the `Service` and `ServiceManager` `await*` methods are `void` methods that throw `TimeoutException`. This seems contrary to JDK precedent, which appears to [use `TimeoutException` exclusively for non-`void` methods](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/class-use/TimeoutException.html). There are tradeoffs here (performance vs. chance of unintentionally ignoring a failure). It may also be worth noting that our `await*` methods can also throw `IllegalStateException` on failure, so we're already somewhat exception-oriented. Anyway, this feels more like an arguable wart than something we'd actually change. =||= Hmm, `ServiceManager` does have [a no-`Executor` overload of its `addListener` method](https://guava.dev/releases/snapshot-jre/api/docs/com/google/common/util/concurrent/ServiceManager.html#addListener-com.google.common.util.concurrent.ServiceManager.Listener-), which is contrary to our usual practices. We may want to take a look at removing that. But that shouldn't interfere with removing `@Beta` from the rest of the API. =||= `ImmutableMultimap` is an unfortunate return type for `servicesByState()`: We recommend either `ImmutableListMultimap` or `ImmutableSetMultimap`, as appropriate (here, `ImmutableSetMultimap`). Shockingly, this _might_ be the only place that we inappropriately returned `ImmutableMultimap` / `Multimap`. We could try to fix that if we wanted. =||= Note that we can improve the return type of `servicesByState()` compatibly by injecting a bridge method. =||= For #418, I think the best solution is to start a fresh instance of the `Service` class. That also makes it much easier to implement correct services.

For #1406 I‚Äôve got a full implementation of this in Misk; here's an [example test](https://github.com/cashapp/misk/blob/master/misk-service/src/test/kotlin/misk/ServiceGraphBuilderTest.kt). The trickiest part of our solution was expressing dependency relationships without instantiating Service objects first. For example, we won‚Äôt construct `SchemaMigratorService` until `DatabaseConnectionService` is `RUNNING`. Our solution is deeply coupled to Guice because it‚Äôs what does the instance creation stuff. I found it very convenient to express service dependencies alongside DI.
 =||= Thanks. I suspect that we will keep the no-`Executor` overload of `addListener` as `@Beta` so that we can deprecate and remove it, but I'm optimistic that we can remove `@Beta` from the rest. I'll try to have an update by the end of the week. =||= For #1406 we've done something kind of like what you have @swankjesse, but using a Kotlin DSL:
```kotlin
class CoordinatedServicesBuilder {
    private val dependencyGraph = GraphBuilder.directed().build<Service>()

    fun Service.dependsOn(vararg upstreamServices: Service) {
        dependencyGraph.addNode(this) // allow no dependencies
        upstreamServices.forEach { service ->
            dependencyGraph.putEdge(this, service)
        }
    }

    fun build(): Set<Service> {
        require(!Graphs.hasCycle(dependencyGraph))
        // Assemble the set of coordinated services
    }
}

fun createCoordinatedServices(init: CoordinatedServicesBuilder.() -> Unit) =
    CoordinatedServicesBuilder().apply(init).build()
```

Usage is then:
```kotlin
val serviceManager = 
    ServiceManager(
        createCoordinatedServices {
            serviceA.dependsOn(serviceB)
            serviceB.dependsOn(serviceC)
            serviceD.dependsOn()
        }
    )
```

We weren't worried about instantiation order. We also built an extension to ServiceManager to allow it to be used as a Service - since we have some Services that manage many other Services from one class. Not sure how much general utility that could find. =||= As hinted at [in #2966](https://github.com/google/guava/issues/2966#issuecomment-604029891), we aren't sure if we love the contract of `AbstractExecutionService.triggerShutdown`, so we might leave that `@Beta`, too, recommending that users who want similar functionality (and want to avoid `@Beta` APIs) attach a `stopping` listener to do that sort of work.

Nothing new has come up in the past couple days, though, so I've started work on deprecating the 1-arg `addListener`.

\[edit: following after https://github.com/google/guava/commit/ce37aee980860798636f80ff67e0c00999a47696 \] =||= Progress:
- Deprecated 1-arg overload of `ServiceManager.addListener`.
- Made `Duration` overloads of `awaitRunning` and `awaitTerminated` `final` in all `Abstract*Service` classes.
- Changed return type of `ServiceManager.servicesByState()` to `ImmutableSetMultimap` (but also retained a method with the old signature for binary compatibility). \[not yet mirrored out\]

I'm planning to put `@Beta` on `AbstractExecutionService.triggerShutdown` and `AbstractService.doCancelStart` and then remove `@Beta` from the types under discussion.

If anyone objects, please speak up soon :) =||= Jesse / others: Let me know how this looks. (I tweaked Jesse's CL slightly to keep 2 individual methods `@Beta`, but other than that, it should look just how you'd expect.) =||= # üéâ
# Œ≤
# üíØ

Thanks! =||= "MOE Sync 2020-04-10"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Remove `@Beta` from `Service` and `ServiceManager`.

This leaves `AbstractListeningExecutorService` as `@Beta`.

Fixes #3806, #3418
Relevant to #2966

(I have tweaked Jesse's initial PR to leave `AbstractExecutionThreadService.triggerShutdown` and `AbstractService.doCancelStart` as `@Beta`, since we aren't sure we like the locking behavior of the former, and we've realized that `Listener.stopping` _might_ be a reasonable substitute for both.)

RELNOTES=`util.concurrent`: Removed `@Beta` from `Service` and related classes.

33574d771b099991822ed78a726df0eea4646eea"Chris Povirkcpovirk04/10/20, 03:45:52 PM
3857.03872Updated readme.MD with some grammar corrections"Added ',' below the heading 'Adding Guava to your build'.
Added ',' in front of 'i.e' at the first 'Important Warnings'.
Removed an unnecessary ',' in the first 'Important Warnings'.""
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3857) for more info**.

<!-- need_sender_cla --> =||= I signed a CLA
 =||= @rohitpotdukhe check the exact message the bot wrote

> Once you've signed (or fixed any issues), please reply here with (at)googlebot I signed it! and we'll verify it.

The quote fixed it now for you. =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3857) for more info**.

<!-- ok --> =||= @googlebot I signed it!  =||= > @rohitpotdukhe check the exact message the bot wrote
> 
> > Once you've signed (or fixed any issues), please reply here with (at)googlebot I signed it! and we'll verify it.
> 
> The quote fixed it now for you.

oh my bad, thank you for pointing that out for me. =||= "MOE Sync 2020-04-22"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Update readme with some grammar corrections.

Closes #3857

c6707a7f1bbffad71b4a5f8ff7266cb41b0f9f66"David P. Bakernetdpb04/22/20, 02:45:08 PM
3873.03876Sets.cartesianProduct.contains' complexity depended on now-removed optimization in Android versionThis was almost certainly my fault, but as I look at the implementation of Sets.cartesianProduct, I think its `contains` method made the assumption that `ImmutableSet.asList().indexOf` was O(1), which is no longer the case for Android.  It should probably get a specific `contains` implementation that actually is O(sets), not O(sets*setSize).MOE Sync 2020-04-24"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix GitHub #3873 by reimplementing Cartesian{Set,List}.contains.

RELNOTES=Fixed #3873.

27506700d2ce3a3a24840aa0ba932dba4a275663"David P. Bakernetdpb04/24/20, 02:58:34 PM
3883.03885Move comment to a more appropriate locationSigned-off-by: Sebastian Zarnekow <sebastian.zarnekow@gmail.com>"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3883) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3883) for more info**.

<!-- ok --> =||= Thanks!

A quick question in case you happen to have immediate thoughts on it. If not, no problem.

Is it suspicious that the `putCoalescing` implementation for `subRangeMap` has the very kind of `range.isEmpty()` check that this comment seems to warn against?
https://github.com/google/guava/blob/bc7248bcb0a987e18cf7a4e7ef92ed458086f4b0/guava/src/com/google/common/collect/TreeRangeMap.java#L511 =||= Good catch. Test and fix is in https://github.com/google/guava/pull/3886 =||= "MOE Sync 2020-04-28"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Move comment to a more appropriate location

The comment was added along with putCoalescing in CL 143507326.

Fixes #3883

8a704a86f565065a7573a13bb95d919a6c5bcbeb"Chris Povirkcpovirk04/28/20, 03:40:29 PM
3886.03887Fixed TreeRangeMap.SubRangeMap.putCoalescing"The short circuiting on an attempt to put an empty range caused the contract of putCoalescing to be violated.

Signed-off-by: Sebastian Zarnekow <sebastian.zarnekow@gmail.com>"Thanks! =||= MOE Sync 2020-04-28"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fixed TreeRangeMap.SubRangeMap.putCoalescing

The short circuiting on an attempt to put an empty range caused the contract of putCoalescing to be violated.

Fixes #3886

6e0e978abc6d3de458ed7e2b9cb0533c735d36a2"Chris Povirkcpovirk04/28/20, 08:35:32 PM
3891.03892Fix equals when comparing two PowerSet instances with different orderFixes https://github.com/google/guava/issues/3890"Thanks for the improvement! That certainly does look like a bug, and I appreciate the reproducing test.

I'll mirror this change internally, and you should see it added back out later today or tomorrow. =||= Cool; thank you! :grin: I'm very glad to have helped. =||= "MOE Sync 2020-05-04"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix PowerSet.equals() when comparing to another PowerSet whose items are the same, but in a different iteration order.

RELNOTES:
  Fix issue where PowerSet.equals(PowerSet) would erroneously return
  false if the PowerSet's underlying Sets were equal, but in a different
  iteration order.

Fixes #3891, #3890

befd5ced9edc93a65c75201eb0698a571398005f"Nicknick-someone05/04/20, 08:39:03 PM
3890.03892PowerSet.equals depends on set's iteration orderIf `com.google.common.collect.Sets.powerSet` is called with two different sets that contain the same elements but in a different iteration order, the returned power sets will also contain the same elements but in a different iteration order. Therefore, `Set.equals` on those power sets is `true`, but `com.google.common.collect.Sets.PowerSet.equals` incorrectly returns `false`.Wow, almost 7 years old! Nice find. =||= Thanks! :grin: =||= üëçüëçüëçüëçüòÄüòÄ =||= MOE Sync 2020-05-04"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix PowerSet.equals() when comparing to another PowerSet whose items are the same, but in a different iteration order.

RELNOTES:
  Fix issue where PowerSet.equals(PowerSet) would erroneously return
  false if the PowerSet's underlying Sets were equal, but in a different
  iteration order.

Fixes #3891, #3890

befd5ced9edc93a65c75201eb0698a571398005f"Nicknick-someone05/04/20, 08:39:03 PM
3880.03893Implement tryLockUninterruptiblyBased on awaitUninterruptibly(Condition, ..)"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3880) for more info**.

<!-- need_sender_cla --> =||= @arhimondr Before this can/will be merged you need to sign the cla. Check the message from the googlebot. =||= @original-codematrix I'm on it. Hopefully I'm going to be able to sign soon. =||= @googlebot I signed it! =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3880) for more info**.

<!-- ok --> =||= @original-codematrix done =||= "MOE Sync 2020-05-06"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Adds constants for `Cross-Origin-Embedder-Policy(-Report-Only)?` headers ([W3](https://wicg.github.io/cross-origin-embedder-policy/#COEP)).

RELNOTES=Adds constants for `Cross-Origin-Embedder-Policy(-Report-Only)?` headers.

a061f7e066ad470b47b749c0514ac581cf2397e2

-------

<p> Implement tryLockUninterruptibly

Fixes #3880

c9278360493d074ecc88c9d42adbcde2ad90f035"Nicknick-someone05/06/20, 11:35:55 PM
3878.03899Issue #3874: Improve cartesianProduct.lastIndexOf Implemented `lastIndexOf()` in `CertesianList` and added appropriate tests.MOE Sync 2020-05-13"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> In ImmutableIntArray, use Arrays.copyOf when expanding the internal array.

909bdb290675c41238a194ad32e6686cda58f6dc

-------

<p> Implemented lastIndexOf in CartesianList

Fixes #3878

13da6dd1e8446bc2e5e6a5ac6e87e82ce0b7743f"Kurt Alfred Klueverkluever05/13/20, 02:20:39 PM
3911.03922UnmodifiableMultimap.forEach inefficiently uses the default implementation`UnmodifiableMultimap.forEach` uses the `Multimap.forEach` default implementation which involves listing entries, and creating a new lambda instead of simply passing the BiConsumer through to the protected instance. This is safe to pass directly though because `forEach(BiConsumer)` is a read-only operation.Proposed solution: https://github.com/google/guava/pull/3912 =||= MOE Sync 2020-06-08"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Efficient UnmodifiableMultimap forEach

forEach can pass calls directly to the delegate protected
collection because it is a read-only operation.

Fixes #3911
Fixes #3912

98a616453df021b0792beb71c81b94d73e0cb69b

-------

<p> Add Comparators.min/max

RELNOTES=`collect`: Added two-element min and max methods to Comparators.

fc7433e647e82057ccc040885bf38dc503465d54

-------

<p> Discourage Ordering.min(E, E) and max(E, E) in favor of Comparators.min(E, E, Comparator) and max(E, E, Comparator).

RELNOTES=Discourage the use of Ordering.min(E, E) and max(E, E).

8bf31e175d0f103ade07a351ed6135496f635991"Kurt Alfred Klueverkluever06/09/20, 01:09:33 AM
3912.03922Fix #3911 Efficient UnmodifiableMultimap forEach"forEach can pass calls directly to the delegate protected
collection because it is a read-only operation."MOE Sync 2020-06-08"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Efficient UnmodifiableMultimap forEach

forEach can pass calls directly to the delegate protected
collection because it is a read-only operation.

Fixes #3911
Fixes #3912

98a616453df021b0792beb71c81b94d73e0cb69b

-------

<p> Add Comparators.min/max

RELNOTES=`collect`: Added two-element min and max methods to Comparators.

fc7433e647e82057ccc040885bf38dc503465d54

-------

<p> Discourage Ordering.min(E, E) and max(E, E) in favor of Comparators.min(E, E, Comparator) and max(E, E, Comparator).

RELNOTES=Discourage the use of Ordering.min(E, E) and max(E, E).

8bf31e175d0f103ade07a351ed6135496f635991"Kurt Alfred Klueverkluever06/09/20, 01:09:33 AM
3908.03971#1315 Add awaitTerminationUninterruptibly(..) for ExecutorService - M‚Ä¶"@cpovirk 
Kindly review the changes and suggest edits.

Thanks,
Nisarg""
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3908) for more info**.

<!-- need_sender_cla --> =||=  @googlebot I signed it!

On Thu, May 21, 2020 at 7:09 PM googlebot <notifications@github.com> wrote:

> Thanks for your pull request. It looks like this may be your first
> contribution to a Google open source project (if not, look below for help).
> Before we can look at your pull request, you'll need to sign a Contributor
> License Agreement (CLA).
>
> üìù *Please visit https://cla.developers.google.com/
> <https://cla.developers.google.com/> to sign.*
>
> Once you've signed (or fixed any issues), please reply here with @googlebot
> I signed it! and we'll verify it.
> ------------------------------
> What to do if you already signed the CLA Individual signers
>
>    - It's possible we don't have your GitHub username or you're using a
>    different email address on your commit. Check your existing CLA data
>    <https://cla.developers.google.com/clas> and verify that your email is
>    set on your git commits
>    <https://help.github.com/articles/setting-your-email-in-git/>.
>
> Corporate signers
>
>    - Your company has a Point of Contact who decides which employees are
>    authorized to participate. Ask your POC to be added to the group of
>    authorized contributors. If you don't know who your Point of Contact is,
>    direct the Google project maintainer to go/cla#troubleshoot (Public
>    version <https://opensource.google/docs/cla/#troubleshoot>).
>    - The email used to register you as an authorized contributor must be
>    the email used for the Git commit. Check your existing CLA data
>    <https://cla.developers.google.com/clas> and verify that your email is
>    set on your git commits
>    <https://help.github.com/articles/setting-your-email-in-git/>.
>    - The email used to register you as an authorized contributor must
>    also be attached to your GitHub account
>    <https://github.com/settings/emails>.
>
> ‚ÑπÔ∏è *Googlers: Go here
> <https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3908>
> for more info*.
>
> ‚Äî
> You are receiving this because you authored the thread.
> Reply to this email directly, view it on GitHub
> <https://github.com/google/guava/pull/3908#issuecomment-632390610>, or
> unsubscribe
> <https://github.com/notifications/unsubscribe-auth/ADNQ3YFEPL6LADZDHLJJYY3RSWYA3ANCNFSM4NHIUQYQ>
> .
>
 =||= @googlebot I signed it! =||=  @googlebot I signed it!

On Thu, May 21, 2020 at 7:14 PM Nisarg Chokshi <nchokshi95@gmail.com> wrote:

> @googlebot I signed it!
>
> On Thu, May 21, 2020 at 7:09 PM googlebot <notifications@github.com>
> wrote:
>
>> Thanks for your pull request. It looks like this may be your first
>> contribution to a Google open source project (if not, look below for help).
>> Before we can look at your pull request, you'll need to sign a Contributor
>> License Agreement (CLA).
>>
>> üìù *Please visit https://cla.developers.google.com/
>> <https://cla.developers.google.com/> to sign.*
>>
>> Once you've signed (or fixed any issues), please reply here with @googlebot
>> I signed it! and we'll verify it.
>> ------------------------------
>> What to do if you already signed the CLA Individual signers
>>
>>    - It's possible we don't have your GitHub username or you're using a
>>    different email address on your commit. Check your existing CLA data
>>    <https://cla.developers.google.com/clas> and verify that your email
>>    is set on your git commits
>>    <https://help.github.com/articles/setting-your-email-in-git/>.
>>
>> Corporate signers
>>
>>    - Your company has a Point of Contact who decides which employees are
>>    authorized to participate. Ask your POC to be added to the group of
>>    authorized contributors. If you don't know who your Point of Contact is,
>>    direct the Google project maintainer to go/cla#troubleshoot (Public
>>    version <https://opensource.google/docs/cla/#troubleshoot>).
>>    - The email used to register you as an authorized contributor must be
>>    the email used for the Git commit. Check your existing CLA data
>>    <https://cla.developers.google.com/clas> and verify that your email
>>    is set on your git commits
>>    <https://help.github.com/articles/setting-your-email-in-git/>.
>>    - The email used to register you as an authorized contributor must
>>    also be attached to your GitHub account
>>    <https://github.com/settings/emails>.
>>
>> ‚ÑπÔ∏è *Googlers: Go here
>> <https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3908>
>> for more info*.
>>
>> ‚Äî
>> You are receiving this because you authored the thread.
>> Reply to this email directly, view it on GitHub
>> <https://github.com/google/guava/pull/3908#issuecomment-632390610>, or
>> unsubscribe
>> <https://github.com/notifications/unsubscribe-auth/ADNQ3YFEPL6LADZDHLJJYY3RSWYA3ANCNFSM4NHIUQYQ>
>> .
>>
>
 =||= CLAs look good, thanks!

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3908) for more info**.

<!-- ok --> =||= "MOE Sync 2020-07-22"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add awaitTerminationUninterruptibly.

Fixes #3908
Fixes #1315
Somewhat relevant to https://github.com/google/guava/issues/3655
Vaguely relevant to https://github.com/google/error-prone/issues/1490, since it creates a `@CheckReturnValue` variant of a `java.util.concurrent` method that returns `false` to indicate timeout.

RELNOTES=`util.concurrent`: Added `awaitTerminationUninterruptibly`.

1ec90b045a45b4603ea5bd1c296f284ec1c438db"Chris Povirkcpovirk07/22/20, 04:22:32 PM
1315.03971Add awaitTerminationUninterruptibly(..) for ExecutorService"_[Original issue](https://code.google.com/p/guava-libraries/issues/detail?id=1315) created by **chriss.dev** on 2013-03-02 at 12:05 PM_

---

The interface ExecutorService provides the method awaitTermination(long,TimeUnit), it would be nice to have ""uninterruptibly"" pendats in the Uninterruptibles-class like:

boolean awaitTerminationUninterruptibly(ExecutorService executor,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long timeout,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeUnit unit)

//await the termination till the end of all days
void awaitTerminationUninterruptibly(ExecutorService executor)""_[Original comment](https://code.google.com/p/guava-libraries/issues/detail?id=1315#c1) posted by **wasserman.louis** on 2013-11-29 at 05:08 PM_

---

_Issue #1595 has been merged into this issue._
 =||= I would also like this. Let's add votes to this as more people want it. =||= Hey,
I would like to work on this.. So based on the original issue, we need 2 methods:

- `boolean awaitTerminationUninterruptibly(ExecutorService executor, long timeout, TimeUnit unit)`
- `void awaitTerminationUninterruptibly(ExecutorService executor)`

And the 1st one will be similar to `boolean awaitUninterruptibly(CountDownLatch latch, long timeout, TimeUnit unit)` but for the ExecutorService while the 2nd one will call the first one but for a very long time as timeout.

Does this make sense?

Thanks! =||= Thanks!

For the second one, we implement it separately to avoid the calls to `System.nanoTime()` entirely. (Those calls aren't _too_ expensive, but it's straightforward enough to implement both the timed and untimed versions.) As you've probably seen, we have some [existing examples of untimed implementations](https://github.com/google/guava/blob/45958948bea8f7aaf38c1a3dd200ce0263c0bcfa/guava/src/com/google/common/util/concurrent/Uninterruptibles.java#L53). =||= @cpovirk 
The `CountDownLatch` has 2 methods for await (with and without timeout) which is why we can leverage it to avoid the call to `System.nanoTime()`. But for ExecutorService, there is just one `awaitTermination` which needs the timeout. So we will require the call. 
I'll see if I can find a way to bring these 2 methods as close as I can to the current method designs though.

Thanks,
Nisarg =||= Oops, now I understand. I guess you can still avoid calling nanoTime by repeatedly calling awaitTermination with the same large timeout, but I see now why it's not the same as CountDownLatch.

We could also consider not providing the infinite-wait version. =||= Yeah.. I don't see any harm in keeping the method for anyone to use if really need to. I will handle the case where I will set a large timeout and not call `System.nanoTime()` when infinite time method is called. 
What do you think?

Also, along with this code and it's corresponding testcases in the test file, is there anything else that will be needed (documentation, etc)? =||= Thanks, that all sounds great. I don't think we need anything else. =||= @cpovirk Any update on my pull request? =||= "MOE Sync 2020-07-22"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Add awaitTerminationUninterruptibly.

Fixes #3908
Fixes #1315
Somewhat relevant to https://github.com/google/guava/issues/3655
Vaguely relevant to https://github.com/google/error-prone/issues/1490, since it creates a `@CheckReturnValue` variant of a `java.util.concurrent` method that returns `false` to indicate timeout.

RELNOTES=`util.concurrent`: Added `awaitTerminationUninterruptibly`.

1ec90b045a45b4603ea5bd1c296f284ec1c438db"Chris Povirkcpovirk07/22/20, 04:22:32 PM
4012.04020Fixed Typos/Grammatical ErrorsI just ran stuff through grammar checkers and found some typos/grammatical errors. Since I only added some small changes, I didn't think I needed to do anything special like open an issue or something, but if I should in the future please tell me. If you think I got some stuff wrong, I'll fix it but there are definitely some typos in there.Thanks. I'm going to merge the typo fixes and a simplification. The rest of the changes look more neutral (and a few of them look like steps backward). In the interest of getting this merged quickly, I'll stick to the noncontroversial ones. =||= Two of these changes are typo fixes, but _none_ of them fixes a grammatical error. Four go from correct to differently correct, one goes from correct to differently correct but definitely less clear, one goes from correct to incorrect, one goes from debatably correct to definitely incorrect, and one goes from correct code formatting to incorrect code formatting. =||= Thanks for your feedback, I went and changed what I thought you were talking about and now there are only more correct changes (I think). If there is anything else, please let me know. And sorry about the code formatting, I don't know what's going on with that. =||= Ok, I fixed everything you said. Now it's just the bare minimal typos. =||= MOE Sync 2020-09-15"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Make ClosingFuture available in open-source Guava (@Beta).

RELNOTES=`util.concurrent`: Add `ClosingFuture`.

48851566428571694e62dee9f277d9833e78f17a

-------

<p> Fix typos and remove unnecessary words.

Fixes #4012

12c9012b0bde00a99cd454f1af6d90b1e5e11508

-------

<p> Bump checker-qual from 2.11.1 to 3.5.0.

For unfortunate reasons involving internal legacy infrastructure, this is easier than merging #4018. But at least it gets us on the newest major version. That makes it easier to see that it's safe to resolve a conflict between, say, 3.5.0 and 3.6.1 by just using the newer one.

a2ad1ee1fa9fcc591edc79f5e7c160ddd19b851d

-------

<p> Remove spurious annotation to fix Travis build.

f106608d0c58c2c67dcd56e638ace73472768f65"Nicknick-someone09/15/20, 04:52:13 PM
4007.04029Issue #4004 AssertionError from Range.gap.Fix #4004, Got IAE instead of AssertionError."
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F4007) for more info**.

<!-- need_sender_cla --> =||= Thanks. I suspect that what we'd prefer is to avoid calling `describeAsLowerBound` at all in this case. But I'd have to look at `gap` more to confirm (and to figure out what to do instead). =||= I think the problem is the ranges contain each other(intersection), it is illegal for `gap`.
and I made an opposite case.
```java 
Range.atMost(3).gap(Range.atMost(2));
```
```shell
java.lang.AssertionError
	at com.google.common.collect.Cut$BelowAll.describeAsUpperBound(Cut.java:165)
	at com.google.common.collect.Range.toString(Range.java:677)
	at com.google.common.collect.Range.<init>(Range.java:358)
	at com.google.common.collect.Range.create(Range.java:156)
	at com.google.common.collect.Range.gap(Range.java:583)
```

so, I added the ranges check for the `gap`.
PTAL @cpovirk . =||= Sounds reasonable, thanks. Would you also:

- Add your tests for the AssertionError cases

- include the 2 input ranges in the exception message =||= @cpovirk  I added the test and the invalid ranges in the IAE message. 
 =||= Thanks. I got another set of eyes on this, and hopefully we'll get it submitted internally and merged out soon. =||= "MOE Sync 2020-09-17"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix AssertionError from Range.gap.

Fixes #4007, #4004

88593a07f3a04163f2c68cf323a54cd8f8efdd03

-------

<p> Fix random typos in Guava.

Fixes #4021

1102d11be3bbe534a5a569832aeb0099aa0eaa61

-------

<p> Add back web.app to public suffix list

d12e9833c5232032c8e9a0b51c9ea3b9ce5e2b9d

-------

<p> Externally restore @DoNotMock to ClosingFuture.Combiner, and externally add @DoNotMock to ClosingFuture itself.

This implements an alternative workaround for https://bugs.openjdk.java.net/browse/JDK-7101822, replacing the one submitted in CL 331770482.

7b4c82f4e436311184cfb61cd6cfd8fb85a3dbe5"Kurt Alfred Klueverkluever09/17/20, 03:21:08 PM
4004.04029AssertionError from Range.gap"@zhanhb [reports](https://github.com/google/guava/commit/a9dd7098f741d652fe2daf8193b831737dc36aa0#commitcomment-41940819):

```java
Range.atLeast(1).gap(Range.atLeast(2));
```
```txt
java.lang.AssertionError
	at com.google.common.collect.Cut$AboveAll.describeAsLowerBound(Cut.java:259)
	at com.google.common.collect.Range.toString(Range.java:674)
	at com.google.common.collect.Range.<init>(Range.java:357)
	at com.google.common.collect.Range.create(Range.java:155)
	at com.google.common.collect.Range.gap(Range.java:582)
```"MOE Sync 2020-09-17"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix AssertionError from Range.gap.

Fixes #4007, #4004

88593a07f3a04163f2c68cf323a54cd8f8efdd03

-------

<p> Fix random typos in Guava.

Fixes #4021

1102d11be3bbe534a5a569832aeb0099aa0eaa61

-------

<p> Add back web.app to public suffix list

d12e9833c5232032c8e9a0b51c9ea3b9ce5e2b9d

-------

<p> Externally restore @DoNotMock to ClosingFuture.Combiner, and externally add @DoNotMock to ClosingFuture itself.

This implements an alternative workaround for https://bugs.openjdk.java.net/browse/JDK-7101822, replacing the one submitted in CL 331770482.

7b4c82f4e436311184cfb61cd6cfd8fb85a3dbe5"Kurt Alfred Klueverkluever09/17/20, 03:21:08 PM
4021.04029Fixed TyposI found multiple typos in comments and class names, so I fixed it."According to dictionary.com, it is in fact ""interruptible,"" not ""interruptable."" =||= Thanks, I changed it back. =||= "MOE Sync 2020-09-17"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix AssertionError from Range.gap.

Fixes #4007, #4004

88593a07f3a04163f2c68cf323a54cd8f8efdd03

-------

<p> Fix random typos in Guava.

Fixes #4021

1102d11be3bbe534a5a569832aeb0099aa0eaa61

-------

<p> Add back web.app to public suffix list

d12e9833c5232032c8e9a0b51c9ea3b9ce5e2b9d

-------

<p> Externally restore @DoNotMock to ClosingFuture.Combiner, and externally add @DoNotMock to ClosingFuture itself.

This implements an alternative workaround for https://bugs.openjdk.java.net/browse/JDK-7101822, replacing the one submitted in CL 331770482.

7b4c82f4e436311184cfb61cd6cfd8fb85a3dbe5"Kurt Alfred Klueverkluever09/17/20, 03:21:08 PM
4019.04030Issue #4002 UnsupportedOperationException when modify TreeRangeSet.subRangeSet(Range).The same implementation as `remove`.MOE Sync 2020-09-18"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix UnsupportedOperationException from TreeRangeSet.subRangeSet(...).add(...).

Fixes #4019, #4002

3685507ce36e24f111cabb45c6d5c5dd26565aad

-------

<p> Deal with Class#isInstance checks which are guaranteed to be false.

2fa82f2cb6e1d2f6c29b7986be6e95063b65bf71

-------

<p> Change `ForwardingMap.remove(Object)` parameter name from `object` to `key` to match `Map.remove(Object key)`.

Fixes https://github.com/google/guava/issues/4028

204904cbe79852e29aec2e461273f9b6112bd2f9"Kurt Alfred Klueverkluever09/18/20, 04:54:11 PM
4002.04030UnsupportedOperationException when modify TreeRangeSet.subRangeSet(Range)"Unable to modify subRangeSet returned by TreeRangeSet.subRangeSet(Range).
IMO, it should be availiable to do so as specified in the document.

```java
import com.google.common.collect.Range;
import com.google.common.collect.TreeRangeSet;
import org.junit.jupiter.api.Test;

@SuppressWarnings(""UnstableApiUsage"")
public class SubRangeSetTest {

    @Test
    public void testAdd() {
        TreeRangeSet<Integer> set = TreeRangeSet.create();
        Range<Integer> range = Range.closedOpen(0, 5);
        set.subRangeSet(range).add(range);
    }

    @Test
    public void testReplaceAdd() {
        TreeRangeSet<Integer> set = TreeRangeSet.create();
        Range<Integer> range = Range.closedOpen(0, 5);
        set.add(range);
        set.subRangeSet(range).add(range);
    }
}
```

```
java.lang.UnsupportedOperationException
	at java.base/java.util.AbstractMap.put(AbstractMap.java:209)
	at com.google.common.collect.TreeRangeSet.replaceRangeWithSameLowerBound(TreeRangeSet.java:266)
	at com.google.common.collect.TreeRangeSet.add(TreeRangeSet.java:216)
	at com.google.common.collect.TreeRangeSet$SubRangeSet.add(TreeRangeSet.java:894)
	at SubRangeSetTest.testAdd(SubRangeSetTest.java:12)
```
```
java.lang.UnsupportedOperationException
	at com.google.common.collect.UnmodifiableIterator.remove(UnmodifiableIterator.java:46)
	at com.google.common.collect.Iterators.clear(Iterators.java:985)
	at com.google.common.collect.Maps$IteratorBasedAbstractMap.clear(Maps.java:3562)
	at com.google.common.collect.TreeRangeSet.add(TreeRangeSet.java:214)
	at com.google.common.collect.TreeRangeSet$SubRangeSet.add(TreeRangeSet.java:894)
	at SubRangeSetTest.testReplaceAdd(SubRangeSetTest.java:20)
```""Thanks, that sounds like a bug to me, too.

I see a slightly different stack trace (with both guava-29.0-jre.jar and guava-29.0-android.jar), so the exact failure may depend on the Guava version:

```
# -jre
Exception in thread ""main"" java.lang.UnsupportedOperationException
  at java.base/java.util.AbstractMap.put(AbstractMap.java:209)
  at com.google.common.collect.TreeRangeSet.replaceRangeWithSameLowerBound(TreeRangeSet.java:266)
  at com.google.common.collect.TreeRangeSet.add(TreeRangeSet.java:216)
  at com.google.common.collect.TreeRangeSet$SubRangeSet.add(TreeRangeSet.java:894)
  at Issue4002.main(Issue4002.java:8)

# -android
Exception in thread ""main"" java.lang.UnsupportedOperationException
  at java.base/java.util.AbstractMap.put(AbstractMap.java:209)
  at com.google.common.collect.TreeRangeSet.replaceRangeWithSameLowerBound(TreeRangeSet.java:268)
  at com.google.common.collect.TreeRangeSet.add(TreeRangeSet.java:218)
  at com.google.common.collect.TreeRangeSet$SubRangeSet.add(TreeRangeSet.java:899)
  at Issue4002.main(Issue4002.java:8)
```

Sorry for the trouble. We will have a look. =||= Presumably because we don't implement `put` in `SubRangeSetRangesByLowerBound`. =||= This is a stacktrace of ~~subRangeSet.remove~~ replace existing range. It should meet the same stacktrace(UnsupportedOperationException) ~~over all guava versions~~ since 18.0. And StackOverflowerError from 14.0 to 17.0. =||= Oh, thanks, I pasted from the email (which has the original text from your post). It's good to know that both add _and_ remove fail. =||= The codes and stacktraces updated. =||= `subRangeSet` was part of the initial `RangeSet` in Guava 14.0. Calling `add` against that version, I get a `StackOverflowError`... :) I haven't checked whether `add` worked in some intermediate version.

`remove` at least is a successful no-op under 14.0. So that's a definite regression. =||= Oh, sorry, you're saying that `remove` is OK but that `add` is broken -- both in the case in which `add` has to remove an existing range and in the case in which it doesn't. =||= (`add` is broken at least as far back as Guava 20.0.) =||= "MOE Sync 2020-09-18"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Fix UnsupportedOperationException from TreeRangeSet.subRangeSet(...).add(...).

Fixes #4019, #4002

3685507ce36e24f111cabb45c6d5c5dd26565aad

-------

<p> Deal with Class#isInstance checks which are guaranteed to be false.

2fa82f2cb6e1d2f6c29b7986be6e95063b65bf71

-------

<p> Change `ForwardingMap.remove(Object)` parameter name from `object` to `key` to match `Map.remove(Object key)`.

Fixes https://github.com/google/guava/issues/4028

204904cbe79852e29aec2e461273f9b6112bd2f9"Kurt Alfred Klueverkluever09/18/20, 04:54:11 PM
4036.05252Remove unnecessary parens"This PR is related to PR #3191.

In #3191, unnecessary parens in `PairedStats` were omitted, but its similar class, `Stats` was not touched.
I found unnecessary parens in the class, so removed.""
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F4036) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= "MOE Sync 2020-09-29"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Internal changes to ClassPath.

643423a88d854deb863fa08f550a6e41d2823df5

-------

<p> Internal changes to ClassPath.

b7e83b114f95f5b776ed60f5932420e5c5fc24ad

-------

<p> Remove unnecessary parens

Fixes #4036

30c69a1ff047f8dad3abef2c315c305e052da0b2

-------

<p> Also print Android test failures.

0644480db466a331b7bd9fa7a8690f37d05ddda2

-------

<p> Fix ClassPathTest on Android JDK 11.

037e10c0da8159c06fa471142ae923dceb03e4ea"Colin Deckercgdecker09/29/20, 01:44:27 PM
5266.05268Clarified HashMultimap javadoc about concurrencyFixes #3682MOE Sync 2020-10-09"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Clarify `HashMultimap` docs about concurrency.

Closes #5266.
Fixes #3682.

e6b523481b34b2c2007046ea987bf62df92eb0f8

-------

<p> Removed all references to now useless workaround

Fixes #3679
Fixes #5265

26da0949c1cf54eb730578e75fe087f67110ee71"David P. Bakernetdpb10/09/20, 03:43:19 PM
3682.05268MultiMap concurrency unclear Javadoc"From https://github.com/google/guava/issues/135#issuecomment-472966705

The [javadoc for HashMultimap](https://google.github.io/guava/releases/27.0-jre/api/docs/com/google/common/collect/HashMultimap.html)  states:  

> This class is not threadsafe when any concurrent operations update the multimap. Concurrent read operations will work correctly.

Does this mean that it is thread-safe if only one thread writes to the map (while any number of threads may read simultaniously) ? The javadoc for [other MultiMap implementations](https://google.github.io/guava/releases/27.0-jre/api/docs/com/google/common/collect/ArrayListMultimap.html) is the same and i think it should be clearer on that.""This text indeed should be revised.  The only way that concurrent reads are safe is if the last write ""happens-before"" every one of them.  You can't have one thread continuing to write. =||= "MOE Sync 2020-10-09"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Clarify `HashMultimap` docs about concurrency.

Closes #5266.
Fixes #3682.

e6b523481b34b2c2007046ea987bf62df92eb0f8

-------

<p> Removed all references to now useless workaround

Fixes #3679
Fixes #5265

26da0949c1cf54eb730578e75fe087f67110ee71"David P. Bakernetdpb10/09/20, 03:43:19 PM
5268MOE Sync 2020-10-09"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Clarify `HashMultimap` docs about concurrency.

Closes #5266.
Fixes #3682.

e6b523481b34b2c2007046ea987bf62df92eb0f8

-------

<p> Removed all references to now useless workaround

Fixes #3679
Fixes #5265

26da0949c1cf54eb730578e75fe087f67110ee71"David P. Bakernetdpb10/09/20, 03:43:19 PM
5265.05268Removed all references to now useless workaroundFixes #3679MOE Sync 2020-10-09"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Clarify `HashMultimap` docs about concurrency.

Closes #5266.
Fixes #3682.

e6b523481b34b2c2007046ea987bf62df92eb0f8

-------

<p> Removed all references to now useless workaround

Fixes #3679
Fixes #5265

26da0949c1cf54eb730578e75fe087f67110ee71"David P. Bakernetdpb10/09/20, 03:43:19 PM
5272.05275Clarify how to use `IteratorTester`Partially addresses #5254.MOE Sync 2020-10-13"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Clarify how to use `IteratorTester`

When using `IteratorTester`, IntelliJ IDEA automatically imports
`AbstractIteratorTester.KnownOrder`. However `AbstractIteratorTester`
is private, and it is not obvious that one was meant to import
`IteratorTester.KnownOrder` instead. Therefore this commit updates the
Javadoc to give an example of how to use the API properly.

Fixes #5272

c3172e1a55041b118a984bc5863082fda32d8243

-------

<p> Add a bunch of warnings to ExecutionSequencer.

See discussion on CL 335046640.

0b7dfb6ebeff542ac6d013f0a5690ccfce7a1eac"Chris Povirkcpovirk10/13/20, 02:34:45 PM
5276.05277Fix example in documentation for `IteratorTester`Partially addresses #5254 (and fixes my own mistake in https://github.com/google/guava/commit/9f03c474d92e724d2193ab64b5cfbd2b232a715e).MOE Sync 2020-10-13"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Don't call toString() on the results of successful futures.

RELNOTES=AbstractFuture.toString() no longer includes the toString() of the result.

771629df701dfe565024db1cabfe19d7a5b2abfc

-------

<p> Fix example in documentation for `IteratorTester`

I made a mistake and accidentally included an example that does not
compile. Specifically, importing `KnownOrder` as-is does not compile;
instead one needs to import `IteratorTester.KnownOrder`. See #5254 for
more information.

I also changed the example to use `Collections#unmodifiableList`
rather than `ArrayList` because `ArrayList#iterator` does not satisfy
all the requirements of `IteratorFeature#MODIFIABLE`.

Fixes #5276

448afdbd4fc53f8d8f636516e54bfcbad9d6b3c0"Chris Povirkcpovirk10/13/20, 06:49:19 PM
5250.05278google#2058 Add documentation on what happens when exception thrown b‚Ä¶‚Ä¶y CallbackMOE Sync 2020-10-14"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Clarify that Interner should be preferred instead of String.intern(); the existing language implies it's intended _only_ for other types.

See also https://github.com/google/guava/issues/399#issuecomment-61307754

1034a2ee444ad03ec869638efa53b3ae880c7f4d

-------

<p> Document what happens when FutureCallback throws exception.

Fixes #5250, #2058

3d573ac2514c53d678c3855b28d9223fea9c7e8f"Chris Povirkcpovirk10/14/20, 02:09:31 PM
5281.05286"Update IteratorTester example with a greater ""steps"" value"Builds upon my earlier work in https://github.com/google/guava/pull/5272 and https://github.com/google/guava/pull/5276, whilst also addressing https://github.com/google/guava/issues/5254 a bit.MOE Sync 2020-10-16"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Prepare for release 30.0.

06c1d37ea914125b88bc27d0a570df84fe900a4f

-------

<p> Remove deprecated 1-arg ServiceManager.addListener.

[]

RELNOTES=`util.concurrent`: Removed the deprecated 1-arg `ServiceManager.addListener(Listener)`. Use the 2-arg `addListener(Listener, Executor)` overload, setting the executor to `directExecutor()` for equivalent behavior.

d13ebb04258a0caecea56d908a391e7e694004b2

-------

<p> Update IteratorTester example with a greater ""steps"" value

This allows IteratorTester to check the edge case that when an iterator has been exhausted (that is, ""next"" has been called repeatedly until ""hasNext"" returns false) then calling ""next"" on the iterator again exhibits the same behavior as the user's chosen ""known good"" reference implementation.

Fixes #5281

b094a4b3f43645298a7c9bce9b5d72184d7ff4cf"Chris Povirkcpovirk10/16/20, 07:26:20 PM
5298.05307Verify maximumWeight before setting"The maximumWeight builder method is the only method that does the argument verification before the assignment.
It looks like a typo, and does not affect anyone in practice, but it is still better to have the implementation uniform."MOE Sync 2020-11-10"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Refactor ClassPath: replace Scanner with Location class.

75c2c543c6ac64943037630cfa40945feff10f42

-------

<p> Fix documentation for HashCode.toString() that incorrectly claimed it returned in big-endian order.

The implementation of toString() goes through the bytes in the same order that asBytes() returns, so if the order of the underlying bytes is little-endian (as is the case for LongHashCode), then the string will also be little-endian, contradicting what the documentation says.

841129afbd77f8c78bb469de2ece758b418d322b

-------

<p> Optimize Hashing.crc32c() by eliminating two xors for every byte of input.

Benchmarks suggest a modest speedup around 8%.

b685bf7068044cfef0c73163408a0ccebacef203

-------

<p> Add constant for Origin Isolation header

Spec: https://github.com/WICG/origin-isolation

RELNOTES=Adds constant for the Origin-Isolation header.

f3d79119d1e1f9937f332a8c73ed1690dfbb8ffb

-------

<p> Remove outdated reference in docs

3ac6e42a8622be4b122dfd4b9eef989148141148

-------

<p> Add additional test for `Crc32cHashFunction`.

4f7e925397e6ca2b17ce3d563ba1968e94959bd1

-------

<p> Verify maximumWeight before setting

The maximumWeight builder method is the only method that does the argument verification before the assignment.
It looks like a typo, and does not affect anyone in practice, but it is still better to have the implementation uniform.

Fixes #5298

f1d40c3dd5243c5a29fe683fb42f7ff61b2a3068

-------

<p> Do 16-byte strides in CRC32C in c.g.c.hash, resulting in roughly a 3.3x speedup to 1.5 GB/s.

This is probably as good as it gets until Java 11, when we'll have access to the intrinsics that use CRC hardware when available.

6d9e9e33c6a784f86b51c3fac785532351374271

-------

<p> Rollback

*** Original change description ***

Do 16-byte strides in CRC32C in c.g.c.hash, resulting in roughly a 3.3x speedup to 1.5 GB/s.

This is probably as good as it gets until Java 11, when we'll have access to the intrinsics that use CRC hardware when available.

***

916807371db167b99bb8b591a22c9ec07fe2bac2

-------

<p> Backport `combine` to java7 for `ImmutableList` & `ImmutableSet`.

This is so that Java8 code relying on the Java7 branch of Guava can still efficiently collect Guava collections.

a275458c2601c33bfb5ba6ec54e2458feeeff06a

-------

<p> Fix `LoadingCache` minor documentation typo.

Fixes #5503.

59a9556d82fc233acf8c0a3ad00de14e02384f75

-------

<p> Added submitAsync to ClosingFuture.

RELNOTES=""Added `submitAsync(AsyncClosingCallable)` to `ClosingFuture`.""

187db6d240a896be6efb6fc98f014b9d4690fe30

-------

<p> Add `X-Request-ID` to `HttpHeaders`.

Fixes #5306.

RELNOTES=Add `X-Request-ID` to `HttpHeaders`.

0f5a31bbc213f61404189d777b2039842210cab5

-------

<p> Fix Android test failure in ClassPathTest.

Reproduced the error and verified that this change fixes it.

c1f6ac185f0e72998ed30ae72a0983804c5a4f5a"Colin Deckercgdecker11/10/20, 04:47:40 PM
5306.05307Add `X-Request-ID` to `HttpHeaders`"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F5306) for more info**.

<!-- need_sender_cla --> =||= @googlebot I signed it! =||= "MOE Sync 2020-11-10"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> Refactor ClassPath: replace Scanner with Location class.

75c2c543c6ac64943037630cfa40945feff10f42

-------

<p> Fix documentation for HashCode.toString() that incorrectly claimed it returned in big-endian order.

The implementation of toString() goes through the bytes in the same order that asBytes() returns, so if the order of the underlying bytes is little-endian (as is the case for LongHashCode), then the string will also be little-endian, contradicting what the documentation says.

841129afbd77f8c78bb469de2ece758b418d322b

-------

<p> Optimize Hashing.crc32c() by eliminating two xors for every byte of input.

Benchmarks suggest a modest speedup around 8%.

b685bf7068044cfef0c73163408a0ccebacef203

-------

<p> Add constant for Origin Isolation header

Spec: https://github.com/WICG/origin-isolation

RELNOTES=Adds constant for the Origin-Isolation header.

f3d79119d1e1f9937f332a8c73ed1690dfbb8ffb

-------

<p> Remove outdated reference in docs

3ac6e42a8622be4b122dfd4b9eef989148141148

-------

<p> Add additional test for `Crc32cHashFunction`.

4f7e925397e6ca2b17ce3d563ba1968e94959bd1

-------

<p> Verify maximumWeight before setting

The maximumWeight builder method is the only method that does the argument verification before the assignment.
It looks like a typo, and does not affect anyone in practice, but it is still better to have the implementation uniform.

Fixes #5298

f1d40c3dd5243c5a29fe683fb42f7ff61b2a3068

-------

<p> Do 16-byte strides in CRC32C in c.g.c.hash, resulting in roughly a 3.3x speedup to 1.5 GB/s.

This is probably as good as it gets until Java 11, when we'll have access to the intrinsics that use CRC hardware when available.

6d9e9e33c6a784f86b51c3fac785532351374271

-------

<p> Rollback

*** Original change description ***

Do 16-byte strides in CRC32C in c.g.c.hash, resulting in roughly a 3.3x speedup to 1.5 GB/s.

This is probably as good as it gets until Java 11, when we'll have access to the intrinsics that use CRC hardware when available.

***

916807371db167b99bb8b591a22c9ec07fe2bac2

-------

<p> Backport `combine` to java7 for `ImmutableList` & `ImmutableSet`.

This is so that Java8 code relying on the Java7 branch of Guava can still efficiently collect Guava collections.

a275458c2601c33bfb5ba6ec54e2458feeeff06a

-------

<p> Fix `LoadingCache` minor documentation typo.

Fixes #5503.

59a9556d82fc233acf8c0a3ad00de14e02384f75

-------

<p> Added submitAsync to ClosingFuture.

RELNOTES=""Added `submitAsync(AsyncClosingCallable)` to `ClosingFuture`.""

187db6d240a896be6efb6fc98f014b9d4690fe30

-------

<p> Add `X-Request-ID` to `HttpHeaders`.

Fixes #5306.

RELNOTES=Add `X-Request-ID` to `HttpHeaders`.

0f5a31bbc213f61404189d777b2039842210cab5

-------

<p> Fix Android test failure in ClassPathTest.

Reproduced the error and verified that this change fixes it.

c1f6ac185f0e72998ed30ae72a0983804c5a4f5a"Colin Deckercgdecker11/10/20, 04:47:40 PM
3945.05352parent.relativePath'  points at com.google.guava:guava-parent instead of org.sonatype.oss:oss-parent"[WARNING] 
[WARNING] Some problems were encountered while building the effective model for com.google.guava:guava-bom:pom:HEAD-jre-SNAPSHOT
[WARNING] 'parent.relativePath' of POM com.google.guava:guava-bom:HEAD-jre-SNAPSHOT (/home/elharo/guava/guava-bom/pom.xml) points at com.google.guava:guava-parent instead of org.sonatype.oss:oss-parent, please verify your project structure @ line 14, column 11
[WARNING] 
[WARNING] It is highly recommended to fix these problems because they threaten the stability of your build.
[WARNING] 
[WARNING] For this reason, future Maven versions might no longer support building such malformed projects.
[WARNING] "MOE Sync 2020-12-10"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> First step in cleaning up PSL handling. Next stage will be to change the template to store the trie string as a separate static constant, so that I can write a unit test that verifies that.

f0c496c1a6b7a7de08f95bf750aeefc5319121d0

-------

<p> Fix `relativePath` warning for guava-bom.

Fixes #3945.
Closes #5349.

aa80e236c6251b7a8fe529abc3d10e269594baf2"Kurt Alfred Klueverkluever12/10/20, 03:48:59 PM
5349.05352#3945 - Fixed parent.relativePath issue in guava-bomFixed : #3945MOE Sync 2020-12-10"This code has been reviewed and submitted internally. Feel free to discuss on
the PR, and we can submit follow-up changes as necessary.

Commits:
=====
<p> First step in cleaning up PSL handling. Next stage will be to change the template to store the trie string as a separate static constant, so that I can write a unit test that verifies that.

f0c496c1a6b7a7de08f95bf750aeefc5319121d0

-------

<p> Fix `relativePath` warning for guava-bom.

Fixes #3945.
Closes #5349.

aa80e236c6251b7a8fe529abc3d10e269594baf2"Kurt Alfred Klueverkluever12/10/20, 03:48:59 PM
5348.05406Fix compatibility between the cache compute methods and a load"The `asMap().compute` implementation did not take into account that the present value may be loading. A load does not block other writes to that entry and takes into account that it may be clobbered, causing it to automatically discard itself. This is a known design choice that breaks linearizability assumptions (#1881). The compute should check if a load is in progress and call the appropriate internal removal method.

Because a zombie entry remained in the cache and still is marked as loading, the loader could discover entry and try to wait for it to materialize. When the computation is a removal, indicated by a null value, the loader would see this as the zombie's result. Since a cache loader may not return null it would throw an exception to indicate a user bug.

A new `ComputingValueReference` resolves both issues by indicating that the load has completed. The compute's `removeEntry` will then actually remove this entry and the loader will not wait on the zombie. Instead if it observes the entry, it will neither receive a non-null value or wait for it to load, but rather try to load anew under the lock. This piggybacks on the reference collection support where an entry is present but its value was garbage collected, causing the load to proceed. By the time the lock is obtained the compute method's entry was removed and the load proceeds as normal (so no unnecessary notification is produced).

fixes #5342
fixes #2827
resolves underlying cause of #2108"Fix compatibility between the cache compute methods and a load."Fix compatibility between the cache compute methods and a load.

Fixes #5348
Fixes #5342
Fixes #2827
Resolves underlying cause of #2108

RELNOTES=Fix compatibility between the cache compute methods and a load."copybara-service[bot]02/12/21, 04:09:15 PM
5342.05406Cache.asMap() interface makes it possible to map NULL values into the cache"Through the `asMap()` interface it is possible in certain situations to partially map NULL values into the `Cache` which results in an unpredictable state. When using `ConcurrentMap.compute` and `ConcurrentMap.computeIfPresent` it possible to remap a previous value to null rather than removing it, which I think would be the expected behaviour here. 

Attached [CacheNullValueTest.java.zip](https://github.com/google/guava/files/5636058/CacheNullValueTest.java.zip) contains test cases that reproduces this problem, tested on 30.0-jre

""The test case is confusing because it passes due to asserting the invalid behavior. I suspect that the Guava team would prefer to have a failing test to iterate against.

The compute methods are not a good fit with Guava's design, so the implementation has quirks and performance issues. I don't think those methods are commonly used, so they are likely not fully robust.

Can you try [Caffeine](https://github.com/ben-manes/caffeine)? I believe my migration of your test passes, but flipping assertions leads me a little unsure. The builder is almost identical but since async is enabled by default, you'd need to specify `Caffeine.executor(Runnable::run)` to mirror Guava. =||= I took a quick look and proposed a fix in #5348. I haven't been a contributor in many years and my familiarity with the cache internals is hazy, but I don't think anyone still active on the Guava team is any better off than I am. That PR seems to address the problem, but alas I can't be certain there are not edge cases that I missed. =||= "Fix compatibility between the cache compute methods and a load."Fix compatibility between the cache compute methods and a load.

Fixes #5348
Fixes #5342
Fixes #2827
Resolves underlying cause of #2108

RELNOTES=Fix compatibility between the cache compute methods and a load."copybara-service[bot]02/12/21, 04:09:15 PM
2827.05406Cache load + compute methods are incompatible"A `Map.compute` may return `null` to indicate the entry should be removed if present. The `valueReference` is stored within the cache, allowing a subsequent `LoadingCache.get` to wait on it. This results in `LocalCache.waitForLoadingValue` to throw an `InvalidCacheLoadException` with the message `CacheLoader returned null for key`. Since the cache loader was not invoked, this message is incorrect and means the two methods cannot be used together, concurrently.

The user expectation would be that the load proceeds by retrying the load if `null` from a computation (but fails if from a cache loader). That may require using a sentinel value.

You can checkout this [commit](https://github.com/ben-manes/caffeine/commit/764df3aac6aacb78a4fc5a2134f911fd60dfa9f9) and run `MultiThreadedTest` using `./gradlew slowGuavaTest`. 

```java
Expected: is an empty collection
     but: <[Failed: key 15 on operation com.github.benmanes.caffeine.cache.MultiThreadedTest$$Lambda$3/841283083@91eee99
com.google.common.cache.CacheLoader$InvalidCacheLoadException: CacheLoader returned null for key 15.
	at com.google.common.cache.LocalCache$Segment.waitForLoadingValue(LocalCache.java:2321)
	at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2206)
	at com.google.common.cache.LocalCache.get(LocalCache.java:4147)
	at com.google.common.cache.LocalCache.getAll(LocalCache.java:4210)
	at com.google.common.cache.LocalCache$LocalLoadingCache.getAll(LocalCache.java:5154)
	at com.github.benmanes.caffeine.cache.testing.GuavaCacheFromContext$GuavaLoadingCache.getAll(GuavaCacheFromContext.java:422)
	at com.github.benmanes.caffeine.cache.MultiThreadedTest.lambda$1(MultiThreadedTest.java:101)
	at com.github.benmanes.caffeine.testing.Threads$Thrasher.run(Threads.java:149)""It sounds like this shouldn't be too difficult to deal with just by switching to a sentinel value, but if someone wants to send a pull request it'd probably get done more quickly.  Otherwise I'll try to take a whack at this...soon-ish. =||= Actually there are simpler fixes. A sentinel value would be invasive by requiring all read/write methods to check and translate, and computers to allocate a function to translate a null to the sentinel.

- Add a `ComputingValueReference` and have an instanceOf check in `waitForLoadingValue` when a null was detected. This class could extend `LoadingValueReference` as its merely tagging the behavioral difference.
- Add a decorator to the user's `CacheLoader` and move the assertion there. (This would also be needed in `get(key, callable)`).

All would require the cache loading calls to handle a retry loop. These two (or perhaps a similar variant) would be easy to implement and isolates the changes. We could also run a snapshot through the test suites to verify. =||= @lowasser This is fixed in PR #5348 as part of fixing ##5342. =||= "Fix compatibility between the cache compute methods and a load."Fix compatibility between the cache compute methods and a load.

Fixes #5348
Fixes #5342
Fixes #2827
Resolves underlying cause of #2108

RELNOTES=Fix compatibility between the cache compute methods and a load."copybara-service[bot]02/12/21, 04:09:15 PM
3974.05415Removed some redundant 'else's using early return"
Thanks for your pull request. It looks like this may be your first contribution to a Google open source project (if not, look below for help). Before we can look at your pull request, you'll need to sign a Contributor License Agreement (CLA).

:memo: **Please visit <https://cla.developers.google.com/> to sign.**

Once you've signed (or fixed any issues), please reply here with `@googlebot I signed it!` and we'll verify it.

----

#### What to do if you already signed the CLA

##### Individual signers

*   It's possible we don't have your GitHub username or you're using a different email address on your commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).

##### Corporate signers

*   Your company has a Point of Contact who decides which employees are authorized to participate. Ask your POC to be added to the group of authorized contributors. If you don't know who your Point of Contact is, direct the Google project maintainer to [go/cla#troubleshoot](http://go/cla#troubleshoot) ([Public version](https://opensource.google/docs/cla/#troubleshoot)).
*   The email used to register you as an authorized contributor must be the email used for the Git commit. Check [your existing CLA data](https://cla.developers.google.com/clas) and verify that your [email is set on your git commits](https://help.github.com/articles/setting-your-email-in-git/).
*   The email used to register you as an authorized contributor must also be [attached to your GitHub account](https://github.com/settings/emails).
		

‚ÑπÔ∏è **Googlers: [Go here](https://goto.google.com/prinfo/https%3A%2F%2Fgithub.com%2Fgoogle%2Fguava%2Fpull%2F3974) for more info**.

<!-- need_sender_cla --> =||= Hi @pradipta. Many of these look good, and we'll push out a commit that incorporates them, attributed to you, soon. We're not taking the ones where the else branch is of roughly the same size as the if branch, because those seem to have more parallelism. =||= "Remove redundant `else` blocks."Remove redundant `else` blocks.

Fixes #3974.

RELNOTES=n/a"copybara-service[bot]02/24/21, 05:19:13 PM
5488.05497Bump actions/cache from v2.1.4 to v2.1.5"Bumps [actions/cache](https://github.com/actions/cache) from v2.1.4 to v2.1.5.
<details>
<summary>Release notes</summary>
<p><em>Sourced from <a href=""https://github.com/actions/cache/releases"">actions/cache's releases</a>.</em></p>
<blockquote>
<h2>v2.1.5</h2>
<ul>
<li>Fix permissions error seen when extracting caches with GNU tar that were previously created using BSD tar (<a href=""https://github-redirect.dependabot.com/actions/cache/issues/527"">actions/cache#527</a>)</li>
</ul>
</blockquote>
</details>
<details>
<summary>Commits</summary>
<ul>
<li><a href=""https://github.com/actions/cache/commit/1a9e2138d905efd099035b49d8b7a3888c653ca8""><code>1a9e213</code></a> Update cache module to v1.0.7 (<a href=""https://github-redirect.dependabot.com/actions/cache/issues/562"">#562</a>)</li>
<li><a href=""https://github.com/actions/cache/commit/981fa981ed950efef5277587ee4ba0eead30cadf""><code>981fa98</code></a> Merge pull request <a href=""https://github-redirect.dependabot.com/actions/cache/issues/469"">#469</a> from ericmj/patch-1</li>
<li><a href=""https://github.com/actions/cache/commit/4498c5b4d8b0673dbc7d9731bc11d9cc5a2c6087""><code>4498c5b</code></a> Drop the example based on using pip's internals (<a href=""https://github-redirect.dependabot.com/actions/cache/issues/519"">#519</a>)</li>
<li><a href=""https://github.com/actions/cache/commit/4134e6de47156381d31ff74f8aabf86718858f70""><code>4134e6d</code></a> It is not recommended to cache node_modules (<a href=""https://github-redirect.dependabot.com/actions/cache/issues/537"">#537</a>)</li>
<li><a href=""https://github.com/actions/cache/commit/62a4d754427893bc6d043c6d4f5486490cab29b6""><code>62a4d75</code></a> Also cache _build for Elixir</li>
<li>See full diff in <a href=""https://github.com/actions/cache/compare/v2.1.4...1a9e2138d905efd099035b49d8b7a3888c653ca8"">compare view</a></li>
</ul>
</details>
<br />


Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)


</details>""OK, I won't notify you again about this release, but will get in touch when a new version is available.

If you change your mind, just re-open this PR and I'll resolve any conflicts on it. =||= "Bump actions/cache from v2.1.4 to v2.1.5"Bump actions/cache from v2.1.4 to v2.1.5

Bumps [actions/cache](https://github.com/actions/cache) from v2.1.4 to v2.1.5.
- [Release notes](https://github.com/actions/cache/releases)
- [Commits](https://github.com/actions/cache/compare/v2.1.4...1a9e2138d905efd099035b49d8b7a3888c653ca8)

Signed-off-by: dependabot[bot] <support@github.com>

Fixes #5488

RELNOTES=n/a"copybara-service[bot]04/15/21, 10:04:06 PM
